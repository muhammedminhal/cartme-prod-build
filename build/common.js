!function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=14)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n extends Error{constructor(t,e="errCommon"){if(super(),this.isError=!1,Error.captureStackTrace(this,this.constructor),"errServer"==e&&(e="errCommon",console.log(`\n${new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})).toUTCString()} :-`),console.log(t)),"object"==typeof t){if(void 0!==t.errCommon&&(this.errCommon=t.errCommon),void 0!==t.errModuleWise&&(this.errModuleWise=t.errModuleWise),void 0!==t.HTTP_R_S_Code&&(this.HTTP_R_S_Code=t.HTTP_R_S_Code),void 0!==t.isError&&(this.isError=t.isError),t.errCommon||t.errModuleWise||t.HTTP_R_S_Code)return this;this[e]=[],t instanceof Error?(console.log(`\n${new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})).toUTCString()} :-`),console.log(t),this[e].push({strMessage:"SOMETHING_WENT_WRONG"})):this[e].push({strMessage:t.strMessage,objDetails:t.objDetails}),this.isError=!0}else t&&(this[e]=[],this[e].push({strMessage:t}),this.isError=!0)}add(t,e="errCommon"){if("errServer"==e&&(e="errCommon",console.log(`\n${new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})).toUTCString()} :-`),console.log(t)),"object"==typeof t){if(void 0!==t.errCommon&&(this.errCommon=t.errCommon),void 0!==t.errModuleWise&&(this.errModuleWise=t.errModuleWise),void 0!==t.HTTP_R_S_Code&&(this.HTTP_R_S_Code=t.HTTP_R_S_Code),t.errCommon||t.errModuleWise||t.HTTP_R_S_Code)return this;void 0===this[e]&&(this[e]=[]),t instanceof Error?(console.log(`\n${new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})).toUTCString()} :-`),console.log(t),this[e].push({strMessage:"SOMETHING_WENT_WRONG"})):this[e].push({strMessage:t.strMessage,objDetails:t.objDetails}),this.isError=!0}else void 0===this[e]&&(this[e]=[]),this[e].push({strMessage:t}),this.isError=!0}setStatus(t){return this.HTTP_R_S_Code=t,this}send({statusCode:t=400}={}){let e=[];return this.errCommon.length&&this.errCommon.forEach(t=>{e.push(t.strMessage)}),this.HTTP_R_S_Code&&(t=this.HTTP_R_S_Code),{body:{arrErrors:e},statusCode:t}}}e.default=n},function(t,e,r){"use strict";function n(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),n(r(6)),n(r(23)),n(r(24)),n(r(25)),n(r(9)),n(r(26))},function(t,e){t.exports=require("mongodb")},function(t,e,r){"use strict";function n(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),n(r(21)),n(r(22)),n(r(27)),n(r(30)),n(r(33)),n(r(35)),n(r(36)),n(r(37)),n(r(40)),n(r(42))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(41);let o=n.inserManyDBFactory();e.inserManyDB=o;let a=n.inserOneDBFactory();e.inserOneDB=a;let s=n.getListDBFactory();e.getListDB=s;let i=n.getOneDBFactory();e.getOneDB=i;let l=n.deleteDBFactory();e.deleteDB=l;let u=n.updateOneDBFactory();e.updateOneDB=u;let c=n.removeDBFactory();e.removeDB=c},function(t,e){t.exports=require("express")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CLN_USER="cln_user",e.CLN_PRODUCT="cln_product",e.CLN_ORDER="cln_order",e.CLN_ORDER_TRACKING="cln_order_tracking",e.CLN_CATEGORY="cln_category",e.CLN_BRAND="cln_brand",e.CLN_PINCODE="cln_pincode",e.CLN_CART="cln_cart",e.CLN_MODE_PAYMENT="cln_mode_payment",e.CLN_COLOR_STOCK="cln_color_stock",e.CLN_SIZE_STOCK="cln_size_stock",e.CLN_MODULE_SETTINGS="cln_module_settings",e.CLN_ATTENDANCE="cln_attendance",e.CLN_DISTRIBUTER_INVENTORY="cln_distributer_inventory",e.CLN_EXECUTIVE_GEO_LOCATIONS="cln_executive_geo_location",e.CLN_NOTIFICATION="cln_notification",e.CLN_SALE_TARGET="cln_sale_target",e.CLN_LOCATION_TARGET="cln_location_target",e.CLN_PLAN="cln_plan",e.CLN_PAYMENTS="cln_payments",e.CLN_DELEVERY_OPTION="cln_delivery_option",e.CLN_ORDERID_COUNT="cln_orderid_count"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(55);let o=n.registerUserDbFactory();e.registerUserDb=o;let a=n.getUserDetailsDbFactory();e.getUserDetailsDb=a;let s=n.getListUserDBFactory();e.getListUserDB=s;let i=n.updateUserDbFactory();e.updateUserDb=i;let l=n.inActivateUserUserDBFactory();e.inActivateUserUserDB=l},function(t,e){t.exports=require("url")},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.USER_RETAILER="RETAILER",e.USER_EMPLOYEE="EMPLOYEE",e.USER_ADMIN="ADMIN",e.USER_DISTRIBUTER="DISTRIBUTER",e.USER_CUSTOMER="CUSTOMER",e.USER_CLIENTS="CLIENTS",e.USER_USER="USER",e.USER_EMPLOYEE_EXECUTIVE="EXECUTIVE"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(85),o=r(86),a=r(87),s=r(88);let i=n.fileUploadeToS3ControllerFactory();e.fileUploadeToS3Controller=i;let l=o.getModuleSttingsControllerFactory({getModuleSettingsUsecase:s.getModuleSettingsUsecase});e.getModuleSttingsController=l;let u=a.getAutoCompleteControllerFactory({getAutoCompleteUsecase:s.getAutoCompleteUsecase});e.getAutoCompleteController=u;let c=o.createModuleSttingsControllerFactory({createModuleSettingsUsecase:s.createModuleSettingsUsecase});e.createModuleSttingsController=c},function(t,e){t.exports=require("axios")},function(t,e){t.exports=require("razorpay")},function(t,e){t.exports=require("uuid")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(15),s=n(r(16)),i=n(r(17)),l=n(r(18)),u=n(r(0)),c=n(r(19)),d=r(3),f=r(124),_=o.default();try{d.initilizeApp(),d.createMongoDbConnection(),l.default.schedule("* 1 * * *",(async function(){try{await d.planValidation()}catch(t){throw new u.default(t)}}),{scheduled:!0,timezone:"Asia/Kolkata"}),_.use(i.default()),_.use(f.jwtTokenChecking),_.use(s.default.json({limit:"50mb"})),_.use(s.default.urlencoded({limit:"50mb",extended:!0})),_.use((function(t,e,r,n){t instanceof SyntaxError&&"body"in t?r.status(400).send({errCommon:[{strMessage:"INVALID_JSON"}]}):n()})),_.use("/",c.default),_.listen(a.intPort,(function(){console.log("App is listening on port "+a.intPort)}))}catch(t){console.log(new u.default(t).send().body)}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.intPort=4001},function(t,e){t.exports=require("body-parser")},function(t,e){t.exports=require("cors")},function(t,e){t.exports=require("node-cron")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});let o=n(r(5)).default.Router();o.use("/product",r(20)),o.use("/master",r(57)),o.use("/order",r(68)),o.use("/file",r(83)),o.use("/user",r(94)),o.use("/report",r(110)),o.use("/common",r(117)),o.use("/payment",r(118)),e.default=o},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(3),s=r(43);let i=o.default.Router();i.post("/create_product",a.makeController(s.createProductController)),i.post("/delete_product",a.makeController(s.deleteProductController)),i.post("/import_product",a.makeController(s.importProductController)),t.exports=i},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.makeController=function(t){return async(e,r)=>{try{const n=await({body:e.body,query:e.query,params:e.params,ip:e.ip,strTenantId:e.strTenantId,strToken:e.strToken,strUserId:e.strUserId,strType:e.strType,method:e.method,timReceived:new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),path:e.originalUrl,strAudience:(e.get("str-audience")||"").toUpperCase(),headers:{"Content-Type":e.get("Content-Type"),Referer:e.get("referer"),"User-Agent":e.get("User-Agent")}});console.log("TENANT"),console.log(e.strTenantId),console.log("ObjRequst Body\n :",new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))),console.log(e.body),await t(n).then(({headers:t={"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))},type:e="json",statusCode:o=200,body:a})=>{if(!a)throw new Error("EMPTY_RESPONSE");r.set(t),r.type(e),400==o?r.status(o).send({...a,blnAPIStatus:!1}):r.status(o).send({...a,blnAPIStatus:!0,strToken:n.strToken})}).catch(async t=>{let e=new o.default(t).send();r.status(e.statusCode).set({"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}).send({...e.body,blnAPIStatus:!1})})}catch(t){let e=new o.default(t).send();r.status(e.statusCode).set({"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}).send({...e.body,blnAPIStatus:!1})}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(2),a=n(r(0)),s=r(1);let i;async function l(){try{i=await o.MongoClient.connect("mongodb+srv://abdut7:Rahman1**@cluster0.yoytl.mongodb.net/?retryWrites=true&w=majority&replicaSet=cluster0-shard-00-00.yoytl.mongodb.net:27017",{useUnifiedTopology:!0}),console.log("MongoClient Created")}catch(t){throw new a.default(t)}}e.createMongoDbConnection=l,e.getMongoDbConnection=async function(){try{return i||await l(),i.db(s.STR_COMMON_DB)}catch(t){throw new a.default(t)}},e.getMongoDbTransConnection=async function(){try{let t=await o.MongoClient.connect("mongodb+srv://abdut7:Rahman1**@cluster0.yoytl.mongodb.net/?retryWrites=true&w=majority&replicaSet=cluster0-shard-00-02.yoytl.mongodb.net:27017",{useUnifiedTopology:!0}),e=await t.db(s.STR_COMMON_DB),r=await t.startSession();return await r.startTransaction({readConcern:{level:"snapshot"},writeConcern:{w:"majority"}}),{objTransactionClient:t,objConnection:e,objSession:r}}catch(t){throw new a.default(t)}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.USER_MODULE="mdl_user"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STR_COMMON_DB_TENANT_ID="CART_ME",e.STR_COMMON_DB="CART_ME",e.STR_TENANT_ADMIN="ADMIN",e.RAZORPAY_KEY_ID="rzp_live_PbwC4RB1TnmPmO",e.RAZORPAY_SECERT_ID="F42nz6hbPFUdAGqP9Dx2fVJn",e.INT_ESTIMATE_DELIVERY_DAYS=10,e.INT_MAX_MASTER_IMAGE_SIZE=100,e.INT_MAX_PRODUCT_IMAGE_SIZE=512,e.INT_MAX_PROFILE_IMAGE_SIZE=50,e.AWS_ACCESS_KEY_ID="AKIAIQTTA5K5RDRQKOIQ",e.AWS_SECRET_ACCESS_KEY="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",e.AWS_S3_LOCATION="ap-south-1",e.AWS_S3_MASTER_BUCKET="axef",e.AWS_BUCKET_URL="https://axef.s3.ap-south-1.amazonaws.com/",e.SMS_API_KEY="c746d967-eb3c-11ea-9fa5-0200cd936042",e.objModuleSettings={strTenantId:"",strName:"mdl_home",strTheame:"BASIC",chrStatus:"T",strPlan:"DEMO",objProduct:{strSortOrder:"ASC",strSortBy:"strName",blnPriceShow:!0,blnQualityShow:!0},objShop:{blnLogoShow:!0,blnCoverImageShow:["https://axef.s3.ap-south-1.amazonaws.com/0mdlmaster1599550718277.webp"],strLogoUrl:["https://axef.s3.ap-south-1.amazonaws.com/0mdlmaster1599547718936.webp"],strCoverImage:["https://axef.s3.ap-south-1.amazonaws.com/0mdlmaster1599550718277.webp"],strBGColor:"#000FFA",blnAboutShow:!0,strAbout:"YOUR SHOPE DISCRIPTION",strTittle:"YOUR SHOPE NAME",blnTextItalic:!0,blnTextUnderline:!0,blnTextBold:!0,strMobileNumber:""},objCart:{blnOrderNotesShow:!0,blnExtraChargeShow:!0,strOrderMessage:"Order Message",blnGSTField:!1,arrExtraTextBoxes:[{strHead:"PIN CODE",strKey:"strPinCode",strType:"S"}]}},e.arrDeleveryOptions=["TAKE AWAY","HOME DELIVERY"],e.arrDeleveryBrands=[],e.arrDeleveryCategory=[]},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STR_PENDING="PENDING",e.STR_SEND="SEND",e.STR_UNSHIPPED="UNSHIPPED",e.STR_CANCEL="CANCEL",e.STR_RETURNED="RETURNED",e.STR_REFUNDED="REFUNDED",e.OBJ_ORDER_PRIORITY={PENDING:!0,SEND:!0,UNSHIPPED:!0,DELIVERED:!0,CANCEL:!0,RETURNED:!0,REFUNDED:!0,DELETE:!0}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.objPlan={DEMO:{intProductCount:70,intCategoryCount:10,blnMultiProductImages:!0,blnProductDetails:!0,blnDataExport:!0,blnMultiBanner:!0,blnMultiVariance:!0,blnMessage:!0,blnPDF:!0},SILVER:{amount:29900,intProductCount:50,intCategoryCount:5,blnMultiProductImages:!1,blnProductDetails:!1,blnDataExport:!1,blnMultiBanner:!1,blnMultiVariance:!1,blnProductZoom:!1,blnMessage:!1,blnPDF:!1},GOLD:{amount:39900,intProductCount:100,intCategoryCount:10,blnMultiProductImages:!0,blnProductDetails:!0,blnDataExport:!0,blnMultiBanner:!0,blnMultiVariance:!0,blnProductZoom:!0,blnMessage:!0,blnPDF:!0},PLATINUM:{amount:69900,intProductCount:-1,intCategoryCount:-1,blnMultiProductImages:!0,blnProductDetails:!0,blnDataExport:!0,blnMultiBanner:!0,blnMultiVariance:!0,blnProductZoom:!0,blnMessage:!0,blnPDF:!0}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(28)),a=n(r(29)),s=n(r(0));e.hashString=function(t){return new Promise((function(e,r){try{t.length>0?o.default.genSalt(10,(function(r,n){o.default.hash(t,n,(function(t,r){e(r)}))})):r("NULL_INPUT_RECVD")}catch(t){throw new s.default(t)}}))},e.compareHashAndText=function(t,e){return new Promise((async function(r,n){try{if(t&&e){r(await o.default.compareSync(t,e))}else n("NULL_INPUT_RECVD")}catch(t){throw new s.default(t)}}))},e.encryptString=async function(t){return t?(await a.default.AES.encrypt(t,"cartme123")).toString():t},e.decryptString=async function(t){if(!t)return t;console.log("11"),console.log(t);let e=await a.default.AES.decrypt(t,"cartme123");return console.log("12"),console.log(e.toString(a.default.enc.Utf8)),console.log("12"),e.toString(a.default.enc.Utf8)}},function(t,e){t.exports=require("bcryptjs")},function(t,e){t.exports=require("crypto-js")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(31)),a=n(r(0)),s=n(r(32));e.jwtSignIn=async function(t,e){try{let r=await s.default.readFileSync("./config/private.key","utf-8"),n=await({issuer:e.issuer,subject:e.subject,audience:e.audience,algorithm:"RS256"});return await o.default.sign(t,r,n)}catch(t){throw new a.default(t)}},e.jwtVerify=async function(t,e){try{let r=await s.default.readFileSync("./config/public.key","utf-8"),n={issuer:e.issuer,subject:e.subject,audience:e.audience,algorithm:"RS256",expiresIn:"300d"};return o.default.verify(t,r,n)}catch(t){throw new a.default(t)}},e.jwtDecode=async function(t){try{return o.default.decode(t,{complete:!0})}catch(t){throw new a.default(t)}}},function(t,e){t.exports=require("jsonwebtoken")},function(t,e){t.exports=require("fs")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(34)),a=n(r(0));async function s(){try{return await o.default.createClient()}catch(t){throw new a.default(t)}}e.initializeRedisConn=s,e.setRedisData=async function(t,e){let r=await s();try{return await r.on("error",(function(t){console.error(t)})),r.set(t,e,o.default.print)}catch(t){throw new a.default(t)}finally{await r.quit()}},e.getRedisData=async function(t){let e=await s();return new Promise((function(r,n){try{e.get(t,(function(t,e){e&&r(e),r(null)}))}catch(t){n(new a.default(t))}finally{e.quit()}}))},e.checkPartialKeyExist=async function(t){let e=await s();return new Promise((function(r,n){try{return e.keys(t+"*",(function(t,e){e&&r(e),r(null)}))}catch(t){n(new a.default(t))}finally{e.quit()}}))}},function(t,e){t.exports=require("redis")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(2),a=n(r(0)),s=r(1);e.objTenantConfig={},e.objOpenAPI={},e.initilizeApp=async function(){console.log("Initiliz");let t=await o.MongoClient.connect("mongodb+srv://abdut7:Rahman1**@cluster0.yoytl.mongodb.net/?retryWrites=true&w=majority&replicaSet=cluster0-shard-00-00.yoytl.mongodb.net:27017",{useUnifiedTopology:!0});console.log("client");let r=await t.db(s.STR_COMMON_DB);console.log("DB");try{let n,o;n=await r.collection("tenantConfig").find({}).toArray(),await n.forEach(t=>{e.objTenantConfig[t.strTenantId]=t}),o=await r.collection("openAPI").find({}).toArray(),await o.forEach(t=>{e.objOpenAPI[t.strEndPoint]=!0})}catch(t){throw new a.default(t)}finally{t.close()}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.makeFileController=function(t){return(e,r)=>{try{const n={body:e.body,file:e.file,files:e.files,query:e.query,params:e.params,ip:e.ip,strTenantId:e.strTenantId,authorization:e.get("x-access-token"),strUserId:e.strUserId,method:e.method,timReceived:new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),path:e.originalUrl,strAudience:(e.get("str-audience")||"").toUpperCase(),headers:{"Content-Type":e.get("Content-Type"),Referer:e.get("referer"),"User-Agent":e.get("User-Agent")}};t(n).then(({headers:t={"Content-Type":"text/plain","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))},type:e="json",statusCode:n=200,body:o})=>{if(!o)throw new Error("EMPTY_RESPONSE");r.set(t),r.type(e),400==n&&r.status(n).send({...o,blnAPIStatus:!1}),r.status(n).send({...o,blnAPIStatus:!0})}).catch(t=>{let e=new o.default(t).send();r.status(e.statusCode).set({"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}).send({...e.body,blnAPIStatus:!1})})}catch(t){let e=new o.default(t).send();r.status(e.statusCode).set({"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}).send({...e.body,blnAPIStatus:!1})}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1),a=n(r(38)),s=n(r(39)),i=n(r(0));e.multiFilesToS3=async function({arrFiles:t,strType:e=null,strQuality:r,strFileNames:n=""}){try{await a.default.config.update({accessKeyId:o.AWS_ACCESS_KEY_ID,secretAccessKey:o.AWS_SECRET_ACCESS_KEY,region:o.AWS_S3_LOCATION});let i=await new a.default.S3,l=[],u="mdlmaster"+Date.now(),c=".jpg",d=n.split("#");for(let n=0;n<t.length;n++){const a=t[n];let f=a.name.split(".");c=f[f.length-1],"BULK_IMPORT"==e&&(u=d[n+1]),await l.push(`${o.AWS_BUCKET_URL}${n}${u}.webp`),r?s.default(a.data).resize(r).toBuffer().then(t=>{i.putObject({Bucket:o.AWS_S3_MASTER_BUCKET,Body:t,Key:`${n}${u}.webp`,ACL:"public-read"},(function(t,e){t&&console.log("Error uploading data: ",t)}))}).catch(t=>{console.log("err"),console.log(t)}):s.default(a.data).toBuffer().then(t=>{i.putObject({Bucket:o.AWS_S3_MASTER_BUCKET,Body:t,Key:`${n}${u}.webp`,ACL:"public-read"},(function(t,e){t&&console.log("Error uploading data: ",t)}))}).catch(t=>{console.log("err"),console.log(t)})}return{arrImageUrl:l}}catch(t){throw new i.default(t)}}},function(t,e){t.exports=require("aws-sdk")},function(t,e){t.exports=require("sharp")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(6),a=r(4),s=n(r(0)),i=r(1);e.planValidation=async function(){try{let t=new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));console.log("VALIDATIONS");let e=await a.getListDB({strCollection:i.CLN_USER,arrQuery:[{$match:{$and:[{chrStatus:"N"},{strType:i.USER_CLIENTS},{strPlanStatus:"ACTIVE"},{strPlanExpiryDate:{$lte:new Date(new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}}]}}]});if(e.length){let r={strPlanStatus:"BLOCK",strPlanBlockDate:t};e.forEach(t=>{a.updateOneDB({strCollection:i.CLN_PLAN,objDocument:r,objQuery:{chrStatus:"N",strTenantId:t.strTenantId}}),a.updateOneDB({strCollection:o.CLN_MODULE_SETTINGS,objDocument:r,objQuery:{chrStatus:"N",strTenantId:t.strTenantId}}),a.updateOneDB({strCollection:i.CLN_USER,objDocument:r,objQuery:{chrStatus:"N",strTenantId:t.strTenantId}})})}}catch(t){throw new s.default(t)}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0));e.getListDBFactory=function(){return async function({strCollection:t,arrQuery:e}){try{return(await o.getMongoDbConnection()).collection(t).aggregate(e).toArray()}catch(t){throw new a.default(t)}}},e.getOneDBFactory=function(){return async function({strCollection:t,objSet:e=null,objQuery:r}){try{let n=await o.getMongoDbConnection();if(e){return(await n.collection(t).findOneAndUpdate(r,{$set:e})).value}return n.collection(t).findOne(r)}catch(t){throw new a.default(t)}}},e.inserManyDBFactory=function(){return async function({strCollection:t,arrInsertDocuments:e}){try{let r=await o.getMongoDbConnection();return await r.collection(t).insertMany(e),{strMessage:"Success"}}catch(t){throw new a.default(t)}}},e.inserOneDBFactory=function(){return async function({strCollection:t,objDocument:e}){try{return(await o.getMongoDbConnection()).collection(t).insertOne(e)}catch(t){throw new a.default(t)}}},e.updateOneDBFactory=function(){return async function({strCollection:t,objQuery:e,objDocument:r}){try{let n=await o.getMongoDbConnection();return await n.collection(t).updateOne(e,{$set:r}),{strMessage:"UPDATE_SUCCESS"}}catch(t){throw new a.default(t)}}},e.removeDBFactory=function(){return async function({strCollection:t,objQuery:e}){try{let r=await o.getMongoDbConnection();return await r.collection(t).deleteOne(e),{strMessage:"DELETE_SUCCESS"}}catch(t){throw new a.default(t)}}},e.deleteDBFactory=function(){return async function({strCollection:t,arrDeleteId:e,strModifiedTime:r,strModifiedUser:n}){let s=await o.getMongoDbConnection();try{if((await s.collection(t).find({_id:{$in:e}}).toArray()).length!=e.length)throw new a.default("ITEM_MISMACTH");return await s.collection(t).updateMany({_id:{$in:e}},{$set:{chrStatus:"D",strModifiedTime:r,strModifiedUser:n}}),{}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.exportController=function(t){return async(e,r)=>{try{const n=await({body:e.body,query:e.query,params:e.params,ip:e.ip,strTenantId:e.strTenantId,strToken:e.strToken,strUserId:e.strUserId,strType:e.strType,method:e.method,timReceived:new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),path:e.originalUrl,strAudience:(e.get("str-audience")||"").toUpperCase(),headers:{"Content-Type":e.get("Content-Type"),Referer:e.get("referer"),"User-Agent":e.get("User-Agent")}});console.log("TENANT"),console.log(e.strTenantId),console.log("ObjRequst Body\n :",new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))),console.log(e.body),await t(n).then(({headers:t={"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))},type:e="json",statusCode:n=200,body:o})=>{if(!o)throw new Error("EMPTY_RESPONSE");r.set(t),r.type(e),400==n?r.status(n).send({...o,blnAPIStatus:!1}):r.status(n).send(o)}).catch(async t=>{let e=new o.default(t).send();r.status(e.statusCode).set({"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}).send({...e.body,blnAPIStatus:!1})})}catch(t){let e=new o.default(t).send();r.status(e.statusCode).set({"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}).send({...e.body,blnAPIStatus:!1})}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(44),o=r(56);let a=o.createProductControllerFactory({createProductUsecase:n.createProductUsecase});e.createProductController=a;let s=o.getListProductControllerFactory({getListProductUsecase:n.getListProductUsecase});e.getListProductController=s;let i=o.getListProductCartControllerFactory({getListProductCartUsecase:n.getListProductCartUsecase});e.getListProductCartController=i;let l=o.getProductDetailsControllerFactory({getProductDetailsUsecase:n.getProductDetailsUsecase});e.getProductDetailsController=l;let u=o.deleteProductControllerFactory({deleteProductUsecase:n.deleteProductUsecase});e.deleteProductController=u;let c=o.importProductControllerFactory({importProductUsecase:n.importProductUsecase});e.importProductController=c},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(45),a=r(4),s=r(47),i=n(r(49)),l=n(r(50)),u=n(r(51)),c=n(r(52)),d=n(r(53)),f=n(r(54)),_=r(7);let y=i.default({productEntity:o.productEntity,deleteProductDB:s.deleteProductDB,createProductDB:s.createProductDB});e.createProductUsecase=y;let D=l.default({getListProductDB:s.getListProductDB,getUserDetailsDb:_.getUserDetailsDb});e.getListProductUsecase=D;let h=f.default({getListDB:a.getListDB,getListProductDB:s.getListProductDB});e.getListProductCartUsecase=h;let g=u.default({getProductDetailsDB:s.getProductDetailsDB});e.getProductDetailsUsecase=g;let b=c.default({deleteProductDB:s.deleteProductDB});e.deleteProductUsecase=b;let C=d.default({productImportEntity:o.productImportEntity,inserManyDB:a.inserManyDB});e.importProductUsecase=C},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(46);let o=n.productEntityFactory();e.productEntity=o;let a=n.productImportEntityFactory();e.productImportEntity=a},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(2);e.productEntityFactory=function(){return async function({strDocId:t,strName:e,strSKUId:r,strDescription:n,strCategory:a,strBrand:i,dblMRP:l,dblSellingPrice:u,arrImageUrl:c,arrSpecification:d,strStock:f,intPosition:_,arrVariance:y,strOperationType:D,blnMultiProductImages:h,blnMultiVariance:g,strCreatedTime:b,strCreatedUser:C,strTenantId:T}){try{let p=u,S=l,w=new o.default;if(!h&&c&&c.length>1&&w.add("THIS PLAN NOT ALLOWED MULTI IMAGES"),!g&&y&&y.length>1&&w.add("THIS PLAN NOT ALLOWED MULTI VARIANCE"),e||w.add("PRODUCT_NAME_MISSING"),p||y[0]?!p&&y[0]&&(p=y[0].dblSellingPrice,S=y[0].dblMRP?y[0].dblMRP:p):w.add("PRODUCT_PRICE_MISSING"),"UPDATE"!=D||t||w.add("PRODUCT_DOC_ID_MISSING"),c||w.add("IMAGE_URLS_MISSING"),w.isError)throw w;let I=` ${e} ${n||""} ${i||" "} ${a||" "} `;return{strOperationType:D||"SAVE",strDocId:t||null,objProduct:{strTenantId:T||"",strName:e,strSKUId:r||"",strDescription:n,strCategory:a||"Other",strBrand:i||"Other",strStock:f||"S",intPosition:_||0,dblMRP:Number(l)||Number(u),dblSellingPrice:Number(p),strImageUrl:c[0]||null,arrImageUrl:c||{},arrVariance:y||[],arrSpecification:d||[],strKeyWords:I,strCreatedTime:b,strCreatedUser:new s.ObjectID(C)||"",chrStatus:"N"}}}catch(t){throw new o.default(t)}}},e.productImportEntityFactory=function(){return async function({objMasters:t,arrProducts:e,strCreatedTime:r,strCreatedUser:n}){try{let t=[],o=[];return e.forEach(e=>{let i=[];if(e.strName||i.push("PRODUCT_NAME_MISSING"),e.strDescription||i.push("PRODUCT_DISCRIPTION_MISSING"),e.dblSellingPrice||i.push("PRODUCT_PRICE_MISSING"),e.dblTotalStock||i.push("PRODUCT_STOCK_MISSING"),e.arrImageUrl||i.push("IMAGE_URLS_MISSING"),i.length)o.push({...e,arrErrors:i});else{e.strDescription||i.push("DISCRIPTION_MISSING"),e.strBrand||i.push("BRAND_MISSING"),e.strUnit||(e.strUnit="Qty"),e.strTargetType||(e.strTargetType="ALL"),e.dblTotalSales||(e.dblTotalSales=0),e.arrScheme||(e.arrScheme=[]),e.strMaterial||e.strMaterial,e.strGenderCategory||(e.strGenderCategory="ALL"),e.intEstiDeliveryDays||(e.intEstiDeliveryDays=a.INT_ESTIMATE_DELIVERY_DAYS);let t=e.strKeyWords?e.strKeyWords:"";e.strKeyWords=`${t}  \n                        ${e.strName}  ${e.strDescription}  \n                        ${e.strMaterial?e.strMaterial:""}  \n                        ${e.strBrand?e.strBrand:""}  \n                        ${e.strCategory?e.strCategory:""}  \n                        ${e.strSubCategory?e.strSubCategory:""}`}let l=[],u=[];e.arrSizeStock&&e.arrSizeStock.forEach(t=>{l.push({strName:t})}),e.arrColorStock&&e.arrColorStock.forEach(t=>{u.push({strName:t})}),t.push({...e,arrColorStock:u,arrSizeStock:l,arrScheme:[],strImageUrl:e.arrImageUrl[0]||null,dblTotalSales:e.dblTotalSales||0,strCreatedTime:r,strCreatedUser:new s.ObjectID(n)||"",chrStatus:"N"})}),{arrSuccessProducts:t,arrErrorProducts:o}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(48);let o=n.createProductDBFactory();e.createProductDB=o;let a=n.getListProductDBFactory();e.getListProductDB=a;let s=n.getProductDetailsDBFactory();e.getProductDetailsDB=s;let i=n.deleteProductDBFactory();e.deleteProductDB=i},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0)),s=r(1);e.createProductDBFactory=function(){return async function({objProduct:t}){let e=await o.getMongoDbConnection();try{return await e.collection(s.CLN_PRODUCT).insertOne(t),{strMessage:"Success"}}catch(t){let e={strName:"PRODUCT NAME ALREADY EXIST",strSKUId:"PRODUCT SKU ALREADY EXIST"},r=new a.default;if("MongoError"==t.name&&"11000"==t.code&&(t.keyValue.strName&&r.add(e.strName),t.keyValue.strSKUId&&r.add(e.strSKUId),r.isError))throw r;throw new a.default(t)}}},e.getListProductDBFactory=function(){return async function({blnCount:t=!0,blnCartCount:e=!1,arrQuery:r}){let n=await o.getMongoDbConnection();try{let o=[],a=[];if(e&&(a=await n.collection(s.CLN_PRODUCT).aggregate(r).toArray(),r.pop(),r.pop(),r.pop()),o=await n.collection(s.CLN_PRODUCT).aggregate(r).toArray(),!o.length)return{arrList:o,objCount:[{intTotalCount:0}]};let i=[];return t&&(r.pop(),r.pop(),r.push({$count:"intTotalCount"}),i=await n.collection(s.CLN_PRODUCT).aggregate(r).toArray()),{arrList:a.concat(o),objCount:i}}catch(t){throw new a.default(t)}}},e.getProductDetailsDBFactory=function(){return async function({arrQuery:t}){let e=await o.getMongoDbConnection();try{return e.collection(s.CLN_PRODUCT).aggregate(t).toArray()}catch(t){throw new a.default(t)}}},e.deleteProductDBFactory=function(){return async function({chrStatus:t="D",arrDeleteId:e,strModifiedTime:r,strModifiedUser:n}){let i=await o.getMongoDbConnection();try{if((await i.collection(s.CLN_PRODUCT).find({_id:{$in:e}}).toArray()).length!=e.length)throw new a.default("ITEM_MISMACTH");return await i.collection(s.CLN_PRODUCT).updateMany({_id:{$in:e}},{$set:{chrStatus:t,strModifiedTime:r,strModifiedUser:n}}),{}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(2),s=r(4),i=r(1);e.default=function({productEntity:t,createProductDB:e,deleteProductDB:r}){return async function({source:n,body:l}){try{console.log("source"),console.log(n);let u=n.strTenantId,c=await t({...l,strCreatedTime:n.timReceived,strCreatedUser:n.strUserId,strTenantId:n.strTenantId,blnMultiProductImages:n.blnMultiProductImages,blnMultiVariance:n.blnMultiVariance});if("UPDATE"==l.strOperationType)return await r({arrDeleteId:[new a.ObjectID(c.strDocId)],chrStatus:"M",strModifiedTime:n.timReceived,strModifiedUser:n.strUserId}),e({objProduct:{...c.objProduct,strTenantId:u}});{let t={$and:[]};t.$and.push({chrStatus:"N"}),t.$and.push({strTenantId:n.strTenantId});let r=await s.getListDB({strCollection:i.CLN_PRODUCT,arrQuery:[{$match:t},{$count:"intTotalCount"}]}),a=r[0]&&r[0].intTotalCount?r[0].intTotalCount:0;if(a=Number(a)+1,console.log("intCount"),console.log(a),n.intProductCount<a&&-1!=n.intProductCount)throw new o.default("PRODUCT LIMIT EXEED");return e({objProduct:{...c.objProduct,strTenantId:u}})}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1);e.default=function({getListProductDB:t,getUserDetailsDb:e}){return async function({source:r,body:n}){try{let o={$and:[]};o.$and.push({chrStatus:"N"}),o.$and.push({strTenantId:r.strTenantId}),n.arrBrands&&n.arrBrands.length&&o.$and.push({strBrand:{$in:n.arrBrands}}),n.arrCategory&&n.arrCategory.length&&o.$and.push({strCategory:{$in:n.arrCategory}}),n.arrProductName&&n.arrProductName.length&&o.$and.push({strName:{$in:n.arrProductName}}),n.intAmountLimit&&o.$and.push({dblSellingPrice:{$lte:Number(n.intAmountLimit)}}),n.strStock&&o.$and.push({strStock:n.strStock}),n.strSearch&&o.$and.push({strKeyWords:{$regex:""+n.strSearch,$options:"i"}});let s=[];if(s.push({$match:o}),n.strSort){let t={$sort:{[n.strSort]:"ASC"==n.strSortActive?1:-1}};s.push(t)}else{let t={$sort:{intPosition:"ASC"==n.strSortActive?1:-1}};s.push(t)}let i=Number(n.intPageNo)*Number(n.intLimit);await s.push({$limit:i+Number(n.intLimit)||50}),await s.push({$skip:i||0});let l={};l=await t({strTenantId:r.strTenantId||a.STR_COMMON_DB_TENANT_ID,arrQuery:s});let u=await e({strUserPK:r.strUserId,strTenantId:r.strTenantId});return{...n,intTotalCount:l.objCount[0].intTotalCount||0,arrList:l.arrList,...u}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(2);e.default=function({getProductDetailsDB:t}){return async function({source:e,body:r}){try{if(!r.strProductId)throw new o.default("PRODUCT_ID_MISSING");let n={chrStatus:"N",_id:new s.ObjectId(r.strProductId)},i=[];i.push({$match:n});let l=[];return l="COMMON"==r.strTargetType?await t({strTenantId:a.STR_COMMON_DB_TENANT_ID,arrQuery:i}):await t({strTenantId:e.strTenantId,arrQuery:i}),{...r,...l[0]}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(6),a=n(r(0)),s=r(1),i=r(2);e.default=function({deleteProductDB:t}){return async function({source:e,body:r}){try{let n=[];return r.arrDeleteId.forEach(t=>{n.push(new i.ObjectID(t))}),"COMMON"==r.strTargetType&&await t({arrDeleteId:n,strTenantId:s.STR_COMMON_DB_TENANT_ID,strModifiedTime:e.timReceived,strModifiedUser:e.strUserId}),await t({arrDeleteId:n,strCollection:o.CLN_USER,strTenantId:e.strTenantId,strModifiedTime:e.timReceived,strModifiedUser:e.strUserId}),{strMessage:"DELETE_SUCCESS"}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1);e.default=function({productImportEntity:t,inserManyDB:e}){return async function({source:r,body:n}){try{let o=await t({...n,strCreatedTime:r.timReceived,strCreatedUser:r.strUserId});return await e({strTenantId:r.strTenantId,strCollection:a.CLN_PRODUCT,arrInsertDocuments:o.arrSuccessProducts}),{arrErrorProducts:o.arrErrorProducts,arrSuccessProducts:o.arrSuccessProducts}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(2);e.default=function({getListProductDB:t,getListDB:e}){return async function({source:r,body:n}){try{let o={$and:[]};o.$and.push({chrStatus:"N"}),o.$and.push({strTenantId:r.strTenantId}),n.arrBrands&&n.arrBrands.length&&o.$and.push({strBrand:{$in:n.arrBrands}}),n.arrCategory&&n.arrCategory.length&&o.$and.push({strCategory:{$in:n.arrCategory}}),n.arrProductName&&n.arrProductName.length&&o.$and.push({strName:{$in:n.arrProductName}}),n.intAmountLimit&&o.$and.push({dblSellingPrice:{$lte:Number(n.intAmountLimit)}}),n.strSearch&&o.$and.push({strKeyWords:{$regex:""+n.strSearch,$options:"i"}}),n.strStock&&o.$and.push({strStock:n.strStock});let i=[];if(i.push({$match:o}),n.strSort){let t={$sort:{[n.strSort]:"ASC"==n.strSortActive?1:-1}};i.push(t)}let l=Number(n.intPageNo)*Number(n.intLimit);await i.push({$limit:l+Number(n.intLimit)||50}),await i.push({$skip:l||0}),await i.push({$lookup:{from:a.CLN_CART,localField:"_id",foreignField:"strProductId",as:"objCart"}}),i.push({$unwind:"$objCart"}),i.push({$match:{"objCart.strUserId":new s.ObjectId(r.strUserId)}});let u={},c=[];u=await t({blnCartCount:!0,arrQuery:i});let d=new Set,f=[],_=Number(u.objCount[0].intTotalCount)||0;u.arrList.forEach(t=>{if(d.has(t._id.toString())){let e=f.indexOf(t._id.toString());c[e].dblCartCount=(c[e]&&c[e].dblCartCount?Number(c[e].dblCartCount):0)+(t.objCart&&t.objCart.dblQty?Number(t.objCart.dblQty):0),--_}else{d.add(t._id.toString()),f.push(t._id.toString());let e=t.objCart&&t.objCart.dblQty?t.objCart.dblQty:0;delete t.objCart,c.push({dblCartCount:e,...t})}});let y=await e({strCollection:a.CLN_CART,arrQuery:[{$match:{$and:[{chrStatus:"N"},{strTenantId:r.strTenantId},{strUserId:new s.ObjectId(r.strUserId)}]}},{$count:"intCartCount"}]});return{...n,...y[0],intTotalCount:_,arrList:c}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0)),s=r(1),i=r(2);e.registerUserDbFactory=function(){return async function({objUser:t}){let e=await o.getMongoDbConnection();try{return await e.collection(s.CLN_USER).insertOne(t),{strMessage:"Success"}}catch(t){let e={strName:"USER NAME ALREADY EXIST",strMobileNo:"MOBILE NUMBER ALREADY EXIST",strEmail:"EMAIL ALREADY EXIST",strTenantId:"EMAIL ALREADY EXIST"},r=new a.default;if("MongoError"==t.name&&"11000"==t.code&&(t.keyValue.strName&&r.add(e.strName),t.keyValue.strMobileNo&&r.add(e.strMobileNo),t.keyValue.strTenantId&&r.add(e.strTenantId),t.keyValue.strTenantId&&r.add(e.strTenantId),r.isError))throw r;throw new a.default(t)}}},e.updateUserDbFactory=function(){return async function({objQuery:t,objSetUser:e,strTenantId:r}){let n=await o.getMongoDbConnection();try{return(await n.collection(s.CLN_USER).findOneAndUpdate(t,e)).value}catch(t){let e={strName:"USER NAME ALREADY EXIST",strMobileNo:"MOBILE NUMBER ALREADY EXIST",strEmail:"EMAIL ALREADY EXIST"},r=new a.default;if("MongoError"==t.name&&"11000"==t.code&&(t.keyValue.strName&&r.add(e.strName),t.keyValue.strMobileNo&&r.add(e.strMobileNo),t.keyValue.strEmail&&r.add(e.strEmail),r.isError))throw r;throw new a.default(t)}}},e.getListUserDBFactory=function(){return async function({strTenantId:t,arrQuery:e,strType:r}){let n=await o.getMongoDbConnection();try{let t=await n.collection(s.CLN_USER).aggregate(e).toArray();return t.length?(e.pop(),e.pop(),e.push({$count:"intTotalCount"}),{arrList:t,objCount:await n.collection(s.CLN_USER).aggregate(e).toArray()}):{arrList:t,objCount:[{intTotalCount:0}]}}catch(t){throw new a.default(t)}}},e.inActivateUserUserDBFactory=function(){return async function({objUpdateUser:t,strUserDocId:e}){let r=await o.getMongoDbConnection();try{return await r.collection(s.CLN_USER).findOneAndUpdate({_id:new i.ObjectID(e)},{$set:t}),{}}catch(t){throw new a.default(t)}}},e.getUserDetailsDbFactory=function(){return async function({strName:t=null,strMobileNo:e=null,strUserPK:r=null,objSetCart:n=null,strActiveStatus:l=null}){let u=await o.getMongoDbConnection();try{let o={chrStatus:"N"};l&&(o.strActiveStatus="A"),t?o.strName=t:e?o.strMobileNo=e:r&&(o._id=new i.ObjectID(r));let c={};if(n){if(c=await u.collection(s.CLN_USER).findOneAndUpdate(o,n),!c.value)throw new a.default("INVALID_USER_NAME");return c.value}if(c=await u.collection(s.CLN_USER).findOne(o),!c)throw new a.default("INVALID_USER_NAME");return c}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(4),s=r(1),i=r(2);e.createProductControllerFactory=function({createProductUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{_id:new i.ObjectId(r.strUserId)}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");console.log(n);let l=n.strPlan&&s.objPlan[n.strPlan]?n.strPlan:"DEMO",u=s.objPlan[l];return{body:await t({source:{...r,...u},body:e})}}catch(t){return new o.default(t).send()}}},e.getListProductControllerFactory=function({getListProductUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{strTenantId:r.strTenantId}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.getListProductCartControllerFactory=function({getListProductCartUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{strTenantId:r.strTenantId}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.getProductDetailsControllerFactory=function({getProductDetailsUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.importProductControllerFactory=function({importProductUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.deleteProductControllerFactory=function({deleteProductUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(3),s=r(58);let i=o.default.Router();i.post("/create_master",a.makeController(s.createMasterController)),i.post("/delete_master",a.makeController(s.deleteMasterController)),t.exports=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(59),o=r(67);let a=o.createMasterControllerFactory({createMasterUsecase:n.createMasterUsecase});e.createMasterController=a;let s=o.getListMasterControllerFactory({getListMasterUsecase:n.getListMasterUsecase});e.getListMasterController=s;let i=o.deleteMasterControllerFactory({deleteMasterUsecase:n.deleteMasterUsecase});e.deleteMasterController=i},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(60),a=r(62),s=n(r(64)),i=n(r(65)),l=n(r(66));let u=s.default({getListMasterDB:o.getListMasterDB});e.getListMasterUsecase=u;let c=i.default({masterEntity:a.masterEntity,deleteMasterDB:o.deleteMasterDB,createMasterDB:o.createMasterDB});e.createMasterUsecase=c;let d=l.default({deleteMasterDB:o.deleteMasterDB});e.deleteMasterUsecase=d},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(61);let o=n.createMasterDBFactory();e.createMasterDB=o;let a=n.getListMasterDBFactory();e.getListMasterDB=a;let s=n.deleteMasterDBFactory();e.deleteMasterDB=s},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0));e.createMasterDBFactory=function(){return async function({strCollection:t,objMaster:e}){let r=await o.getMongoDbConnection();try{return await r.collection(t).insertOne(e),{strMessage:"Success"}}catch(t){let e={strName:"ITEM NAME ALREADY EXIST"},r=new a.default;if("MongoError"==t.name&&"11000"==t.code&&(t.keyValue.strName&&r.add(e.strName),r.isError))throw r;throw new a.default(t)}}},e.getListMasterDBFactory=function(){return async function({strCollection:t,arrQuery:e}){let r=await o.getMongoDbConnection();try{return r.collection(t).aggregate(e).toArray()}catch(t){throw new a.default(t)}}},e.deleteMasterDBFactory=function(){return async function({chrStatus:t="D",strCollection:e,arrDeleteId:r,strModifiedTime:n,strModifiedUser:s}){let i=await o.getMongoDbConnection();try{if((await i.collection(e).find({_id:{$in:r}}).toArray()).length!=r.length)throw new a.default("ITEM_MISMACTH");return await i.collection(e).updateMany({_id:{$in:r}},{$set:{chrStatus:t,strModifiedTime:n,strModifiedUser:s}}),{}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});let n=r(63).masterEntityFactory();e.masterEntity=n},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(2);e.masterEntityFactory=function(){return async function({strTenantId:t,strDocId:e,strName:r,strImgUrl_0:n,strCollection:s,strOperationType:i,objExtras:l,strCreatedTime:u,strCreatedUser:c}){try{let d=new o.default;if(r||d.add("MASTER_NAME_MISSING"),s||d.add("MASTER_COLLECTION_MISSING"),"UPDATE"!=i||e||d.add("MASTER_DOC_ID_MISSING"),d.isError)throw d;return{strOperationType:i||"SAVE",strDocId:e,strCollection:s,objMaster:{strTenantId:t,strName:r,strImgUrl_0:n,strCreatedTime:u,strCreatedUser:new a.ObjectID(c)||"",chrStatus:"N",...l||{}}}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.default=function({getListMasterDB:t}){return async function({source:e,body:r}){try{let n={};if(!r.arrCollection)throw new o.default("INVALID_COLLECTION","errCommon");for(let a of r.arrCollection){if(!a.strCollection)throw new o.default("COLLECTION_NAME_MISSING");let s={$and:[]};s.$and.push({chrStatus:"N"}),s.$and.push({strTenantId:e.strTenantId}),a.objCondition&&s.$and.push(a.objCondition),a.strSearch&&s.$and.push({strName:{$regex:""+a.strSearch,$options:"i"}});let i=[];if(i.push({$match:s}),r.strSort){let t={$sort:{[r.strSort]:"ASC"==r.strSortActive?1:-1}};i.push(t)}await i.push({$limit:a.intLimit?Number(a.intLimit):10}),n[a.strCollection]=await t({strTenantId:e.strTenantId,strCollection:a.strCollection,arrQuery:i})}return n}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(2),s=r(4);e.default=function({masterEntity:t,deleteMasterDB:e,createMasterDB:r}){return async function({source:n,body:i}){try{let l=await t({...i,strCreatedTime:n.timReceived,strCreatedUser:n.strUserId,strTenantId:n.strTenantId});if("UPDATE"==i.strOperationType)return await e({arrDeleteId:[new a.ObjectID(l.strDocId)],chrStatus:"M",strCollection:i.strCollection,strModifiedTime:n.timReceived,strModifiedUser:n.strUserId}),r({strCollection:l.strCollection,objMaster:l.objMaster});{let t={$and:[]};t.$and.push({chrStatus:"N"}),t.$and.push({strTenantId:n.strTenantId});let e=await s.getListDB({strCollection:l.strCollection,arrQuery:[{$match:t},{$count:"intTotalCount"}]}),a=e[0]&&e[0].intTotalCount?e[0].intTotalCount:0;if(a=Number(a)+1,console.log("sou"),console.log(n),console.log("intCount"),console.log(a),n.intCategoryCount<a&&-1!=n.intCategoryCount)throw new o.default("CATEGORY LIMIT EXCEED");return r({strCollection:l.strCollection,objMaster:l.objMaster})}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(2);e.default=function({deleteMasterDB:t}){return async function({source:e,body:r}){try{if(!r.strCollection)throw new o.default("INVALID_COLLECTION");let n=[];return r.arrDeleteId.forEach(t=>{n.push(new s.ObjectID(t))}),"COMMON"==r.strTargetType&&await t({arrDeleteId:n,strTenantId:a.STR_COMMON_DB_TENANT_ID,strCollection:r.strCollection,strModifiedTime:e.timReceived,strModifiedUser:e.strUserId}),await t({arrDeleteId:n,strTenantId:e.strTenantId,strCollection:r.strCollection,strModifiedTime:e.timReceived,strModifiedUser:e.strUserId}),{strMessage:"DELETE_SUCCESS"}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(4),s=r(1),i=r(2);e.createMasterControllerFactory=function({createMasterUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{_id:new i.ObjectId(r.strUserId)}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");{console.log(n);let o=n.strPlan&&s.objPlan[n.strPlan]?n.strPlan:"DEMO",a=s.objPlan[o];return{body:await t({source:{...r,...a},body:e})}}}catch(t){return new o.default(t).send()}}},e.getListMasterControllerFactory=function({getListMasterUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{strTenantId:r.strTenantId}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.deleteMasterControllerFactory=function({deleteMasterUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{strTenantId:r.strTenantId}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(3),s=r(69);let i=o.default.Router();i.post("/get_order",a.makeController(s.getListOrderController)),i.post("/get_order_export",a.exportController(s.getExportOrderController)),i.post("/get_order_details",a.makeController(s.getOrderDetailsController)),i.post("/update_order",a.makeController(s.updateOrderController)),t.exports=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(70),o=r(82);let a=o.getListOrderControllerFactory({getListOrderUsecase:n.getListOrderUsecase});e.getListOrderController=a;let s=o.getOrderDetailsControllerFactory({getOrderDetailsUsecase:n.getOrderDetailsUsecase});e.getOrderDetailsController=s;let i=o.createOrderControllerFactory({createOrderUsecase:n.createOrderUsecase});e.createOrderController=i;let l=o.updateOrderControllerFactory({updateOrderUsecase:n.updateOrderUsecase});e.updateOrderController=l;let u=o.getExportOrderControllerFactory({getExportOrderUsecase:n.getExportOrderUsecase});e.getExportOrderController=u},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(71),a=r(74),s=r(4),i=n(r(76)),l=n(r(77)),u=n(r(78)),c=n(r(79)),d=n(r(80)),f=r(7);let _=l.default({getListOrderDB:a.getListOrderDB,getUserDetailsDb:f.getUserDetailsDb});e.getListOrderUsecase=_;let y=u.default({getOrderDetailsDB:a.getOrderDetailsDB});e.getOrderDetailsUsecase=y;let D=i.default({orderEntity:o.orderEntity,getOneDB:s.getOneDB,getProductStockDB:a.getProductStockDB,createOrderTrackingDB:a.createOrderTrackingDB,getUserDetailsDb:f.getUserDetailsDb,createOrderDB:a.createOrderDB,deleteCartItemsDB:a.deleteCartItemsDB});e.createOrderUsecase=D;let h=c.default({orderEntityTracking:o.orderEntityTracking,getOneDB:s.getOneDB,getUserDetailsDb:f.getUserDetailsDb,getOrderTrackingDB:a.getOrderTrackingDB,createOrderTrackingDB:a.createOrderTrackingDB,updateOrderStatusDB:a.updateOrderStatusDB});e.updateOrderUsecase=h;let g=d.default({getListOrderUsecase:_});e.getExportOrderUsecase=g},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(72),o=r(73);let a=n.orderEntityFactory();e.orderEntity=a;let s=o.orderEntityTrackingFactory();e.orderEntityTracking=s},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(2),i=r(4),l=n(r(8));e.orderEntityFactory=function(){return async function({strTenantId:t,arrProducts:e,dblTotalOrderAmount:r,strGST:n,strOrderNote:u,strMobileNo:c,strAddress:d,strCustomerName:f,strOrderedUserId:_,strModeDelivery:y,strCreatedTime:D,strCreatedUser:h}){try{let g=new o.default,b="OD"+await async function({strTenantId:t}){let e=await i.getOneDB({strCollection:a.CLN_ORDERID_COUNT,objQuery:{strTenantId:t}}),r=e&&e.intLastCount?1+Number(e.intLastCount):1,n={strTenantId:t,intLastCount:r};e&&e._id?await i.updateOneDB({strCollection:a.CLN_ORDERID_COUNT,objQuery:{_id:new s.ObjectId(e._id)},objDocument:n}):await i.inserOneDB({strCollection:a.CLN_ORDERID_COUNT,objDocument:n});return r.toString().length>4?r:3==r.toString().length?"0"+r:2==r.toString().length?"00"+r:1==r.toString().length?"000"+r:r}({strTenantId:t}),C=` *New Order* : #${b}\n*(${y})*\n\nTotal items: *${e.length}* \n`;if(e&&e.length?e.forEach((t,e)=>{t.strProductId||g.add("PRODUCT_ID_MISSING"),t.dblQty||g.add("PRODUCT_QTY_MISSING"),C+=` *${e+1}* - ${t.strName} ${t.strVariance?t.strVariance:""}(${t.dblAmount}) X ${t.dblQty} = ${Number(t.dblQty)*Number(t.dblAmount)}\n`}):g.add("EMTY_PRODUCTS"),C+=`\nTotal Payable: *${r}*\n            \n\n*Name:* \n ${f}\n*Mobile:* \n ${c}\n${d?"*Address:* \n"+d+"\n":""} ${n?"\n\n *GST No:* \n"+n+"\n":" "} ${u?"\n\n *Order Note:* \n"+u:" "}\n\n\n ===========================\n            Please confirm via reply.`,g.isError)throw g;return{objUser:{$set:{chrOrderUser:"T",strMobileNo:c||"",strCustomerName:f||"",strAddress:d||"",chrStatus:"N"}},arrProducts:e,strOrderId:b,strWhatsAppMessage:C,objOrder:{strTenantId:t,strOrderId:b,strKeyWords:`${b} ${y} ${f}  ${y} ${d} ${C}`,dblTotalOrderAmount:Number(r),strOrderStatus:a.STR_PENDING,strOrderedUserId:""!=_&&_?new s.ObjectId(_)||"":new s.ObjectId(h)||"",strGST:n||"",strMobileNo:c||"",strModeDelivery:y||"",strAddress:d||"",strCustomerName:f||"",strCreatedTime:D,strWhatsAppMessage:C,strOrderNote:u||"",strUserWhatsAppUrl:l.default.format({protocol:"https",hostname:"wa.me",pathname:c,query:{text:`Hi ${f} \n    ThankYou For Your Order`}}),strCreatedUser:new s.ObjectId(h)||null,chrStatus:"N"}}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(2),s=r(1),i=n(r(8));e.orderEntityTrackingFactory=function(){return async function({strOrderId:t,strOrderStatus:e,strMobileNo:r,strName:n,strTenantId:l,strCreatedTime:u,strCreatedUser:c}){try{console.log("strName"),console.log(n),console.log("strMobileNo"),console.log(r);let d=new o.default;if(!s.OBJ_ORDER_PRIORITY[e])throw new o.default("INVALID_STATUS");if(d.isError)throw d;return{objTransaction:{},objOrderStatus:{strTenantId:l,strOrderStatus:e,strUpdatedTime:u||null,strUserWhatsAppUrl:i.default.format({protocol:"https",hostname:"wa.me",pathname:r,query:{text:`Hi ${n} \n    Your ORDER IS ${e} \n                    ===============\n                    Have a Nice Day`}}),strUpdateUser:new a.ObjectID(c)||null},objTracking:{strTenantId:l,strCurrentStatus:e,intEstiDeliveryDays:10,strOrderDocId:t,strOrderId:t,strCreatedTime:u||null,strCreatedUser:new a.ObjectID(c)||null}}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(75);let o=n.getProductStockDBFactory();e.getProductStockDB=o;let a=n.getListOrderDBFactory();e.getListOrderDB=a;let s=n.getOrderTrackingDBFactory();e.getOrderTrackingDB=s;let i=n.getOrderDetailsDBFactory();e.getOrderDetailsDB=i;let l=n.createOrderTrackingDBFactory();e.createOrderTrackingDB=l;let u=n.createOrderDBFactory();e.createOrderDB=u;let c=n.updateProductStockDBFactory();e.updateProductStockDB=c;let d=n.updateColorStockDBFactory();e.updateColorStockDB=d;let f=n.updateSizeStockDBFactory();e.updateSizeStockDB=f;let _=n.updateOrderStatusDBFactory();e.updateOrderStatusDB=_;let y=n.deleteCartItemsDBFactory();e.deleteCartItemsDB=y},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(3),i=r(2);e.getProductStockDBFactory=function(){return async function({objConnection:t,objTransOptions:e,objProduct:r}){let n=[{chrStatus:"N"},{_id:new i.ObjectId(r.strProductId)||""}],s=[];await s.push({$match:{$and:n}});try{return(await t.collection(a.CLN_PRODUCT).aggregate(s).toArray())[0]}catch(t){throw new o.default(t)}}},e.createOrderTrackingDBFactory=function(){return async function({objConnection:t,objTransOptions:e,objTracking:r}){try{await t.collection(a.CLN_ORDER_TRACKING).insertOne(r,e)}catch(t){throw new o.default(t)}}},e.createOrderDBFactory=function(){return async function({objConnection:t,objTransOptions:e,objOrder:r}){try{return t.collection(a.CLN_ORDER).insertOne(r,e)}catch(t){throw new o.default(t)}}},e.updateProductStockDBFactory=function(){return async function({objConnection:t,objTransOptions:e,strProductId:r,objSet:n}){try{await t.collection(a.CLN_PRODUCT).updateOne({_id:new i.ObjectId(r)||""},{$set:n},e)}catch(t){throw new o.default(t)}}},e.updateColorStockDBFactory=function(){return async function({objConnection:t,objTransOptions:e,strProductId:r,strName:n,objSet:s}){try{await t.collection(a.CLN_COLOR_STOCK).updateOne({strProductId:new i.ObjectId(r)||"",strName:n},{$set:s},e)}catch(t){throw new o.default(t)}}},e.updateSizeStockDBFactory=function(){return async function({objConnection:t,objTransOptions:e,strProductId:r,strName:n,objSet:s}){try{await t.collection(a.CLN_SIZE_STOCK).updateOne({strProductId:new i.ObjectId(r)||"",strName:n},{$set:s},e)}catch(t){throw new o.default(t)}}},e.getListOrderDBFactory=function(){return async function({strTenantId:t,arrQuery:e,blnNoPagination:r}){let n=await s.getMongoDbConnection();try{let t=await n.collection(a.CLN_ORDER).aggregate(e).toArray();return t.length?(r||(e.pop(),e.pop()),e.push({$count:"intTotalCount"}),{arrList:t,objCount:await n.collection(a.CLN_ORDER).aggregate(e).toArray()}):{arrList:t,objCount:[{intTotalCount:0}]}}catch(t){throw new o.default(t)}}},e.getOrderDetailsDBFactory=function(){return async function({strTenantId:t,arrQuery:e}){let r=await s.getMongoDbConnection();try{return r.collection(a.CLN_ORDER).aggregate(e).toArray()}catch(t){throw new o.default(t)}}},e.getOrderTrackingDBFactory=function(){return async function({objConnection:t,arrQuery:e}){try{return t.collection(a.CLN_ORDER_TRACKING).aggregate(e).toArray()}catch(t){throw new o.default(t)}}},e.updateOrderStatusDBFactory=function(){return async function({objConnection:t,objTransOptions:e,strTenantId:r,objSet:n,arrQuery:s,strOrderId:i}){try{let l=await t.collection(a.CLN_ORDER).aggregate(s).toArray();if(!l.length)throw new o.default("ORDER_ID_NOT_FOUND");console.log("objSet"),console.log(n);let u={...l[0],...n};return await t.collection(a.CLN_ORDER).updateOne({strOrderId:i,strTenantId:r,chrStatus:"N"},{$set:u},e),u}catch(t){throw new o.default(t)}}},e.deleteCartItemsDBFactory=function(){return async function({objConnection:t,objTransOptions:e,strUserId:r,strCreatedTime:n}){try{await t.collection(a.CLN_CART).deleteMany({strUserId:r},e)}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1),a=n(r(0)),s=n(r(8)),i=r(3),l=r(2);e.default=function({orderEntity:t,getProductStockDB:e,createOrderTrackingDB:r,createOrderDB:n,getOneDB:u,getUserDetailsDb:c,deleteCartItemsDB:d}){return async function({source:f,body:_}){let y=await i.getMongoDbTransConnection(),D=y.objTransactionClient,h=y.objSession;try{let i=y.objConnection,g={session:h},b=new a.default,C=await t({..._,strUserType:f.strType,strTenantId:f.strTenantId,strCreatedTime:f.timReceived,strCreatedUser:f.strUserId});console.log("1"),console.log(C);let T=[],p=0;for(let t of C.arrProducts){let r=await e({objConnection:i,objProduct:t,objTransOptions:g});if(console.log("2"),console.log("objStock"),console.log(r),!r)throw new a.default("PRODUCT_NOT_FOUND");"S"!=r.strStock&&b.add("OUT_OF_STOCK"),p+=Number(r.dblSellingPrice),T.push({...t,strName:r.strName,strSKUId:r.strSKUId,dblBEAmount:Number(r.dblSellingPrice)})}if(console.log("4"),b.isError)throw b;await d({objConnection:i,objTransOptions:g,strUserId:new l.ObjectID(f.strUserId),strCreatedTime:f.timReceived});let S=await n({objConnection:i,objTransOptions:g,objOrder:{dblTotalAmount:p,...C.objOrder,arrProducts:T}}),w=await S.insertedId;console.log("9");new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));console.log("10"),await r({objConnection:i,objTransOptions:g,objTracking:{strCurrentStatus:"PENDING",strOrderDocId:w,strOrderId:C.strOrderId,strCreatedUser:f.strUserId,strCreatedTime:f.timReceived}}),await h.commitTransaction(),console.log("11"),await c({strUserPK:f.strUserId,objSetCart:C.objUser});let I=await u({strCollection:o.CLN_MODULE_SETTINGS,strTenantId:f.strTenantId,objQuery:{chrStatus:"N",strName:"mdl_home",strTenantId:f.strTenantId}});return{strWhatsAppMessage:C.strWhatsAppMessage,strOrderId:C.strOrderId,strWhatsAppUrl:s.default.format({protocol:"https",hostname:"wa.me",pathname:I&&I.objShop&&I.objShop.strMobileNumber?I.objShop.strMobileNumber:"",query:{text:C.strWhatsAppMessage}}),strClientWhatsAppNo:I&&I.objShop&&I.objShop.strMobileNumber?I.objShop.strMobileNumber:""}}catch(t){throw await h.abortTransaction(),new a.default(t)}finally{await D.close(),await h.endSession()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(2),s=r(1);e.default=function({getListOrderDB:t,getUserDetailsDb:e}){return async function({source:r,body:n}){try{let o=r.strUserId,i={$and:[]};i.$and.push({chrStatus:"N"}),i.$and.push({strTenantId:r.strTenantId}),r.strType!=s.USER_CLIENTS&&i.$and.push({strOrderedUserId:new a.ObjectID(o)||""}),n.arrStatus&&n.arrStatus.length&&i.$and.push({strOrderStatus:{$in:n.arrStatus}});let l=r.timReceived;switch(n.strDateFilter){case"TODAY":i.$and.push({strCreatedTime:{$gte:new Date(new Date(l.getFullYear(),l.getMonth(),l.getDate(),0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(l.getFullYear(),l.getMonth(),l.getDate(),23,59,59).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}});break;case"WEAK":i.$and.push({strCreatedTime:{$gte:l.setDate(l.getDate()-(l.getDay()+1)),$lte:l}});break;case"MONTH":i.$and.push({strCreatedTime:{$gte:new Date(new Date(l.getFullYear(),l.getMonth(),1,0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:l}})}n.strSearch&&i.$and.push({strKeyWords:{$regex:""+n.strSearch,$options:"i"}}),n.strStartDate&&n.strEndDate&&i.$and.push({strCreatedTime:{$gte:new Date(new Date(n.strStartDate+" 00:00:00").toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(n.strEndDate+" 23:59:59").toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}});let u=[];if(u.push({$match:i}),u.push({$sort:{strCreatedTime:-1}}),u.push({$lookup:{from:s.CLN_USER,localField:"strOrderedUserId",foreignField:"_id",as:"arrOrderUser"}}),n.blnNoPagination);else{let t=Number(n.intPageNo)*Number(n.intLimit&&""!=n.intLimit?n.intLimit:20);await u.push({$limit:t+Number(n.intLimit&&""!=n.intLimit?n.intLimit:20)}),await u.push({$skip:t||0})}let c={};c=await t({strTenantId:r.strTenantId||s.STR_COMMON_DB_TENANT_ID,arrQuery:u,blnNoPagination:n.blnNoPagination||!1});let d=[];await c.arrList.forEach(t=>{let e=t.arrOrderUser[0]?t.arrOrderUser[0]:{};delete t.arrOrderUser;let r="";t.arrProducts.forEach(t=>{r+=`${t.strName}  ${t.strVariance?t.strVariance:""} ${t.dblAmount} x ${t.dblQty} = ${Number(t.dblQty)*Number(t.dblAmount)} \n`});let n=(new Date(t.strCreatedTime).getTime()-l.getTime())/1e3,o="";2==n.toString().length?o=Math.abs(Math.round(n))+"  sec":2==(n/60).toString().length?(n/=60,o=Math.abs(Math.round(n))+"  min"):2==(n/3600).toString().length?(n/=3600,o=Math.abs(Math.round(n))+"  hr"):2==(n/86400).toString().length&&(n/=86400,o=Math.abs(Math.round(n))+"  day");let a=new Date(t.strCreatedTime).toISOString().split("-");d.push({...t,...e,dblTotalOrderAmount:t.dblTotalOrderAmount,strItem:r+"Total : "+t.dblTotalOrderAmount,strCreatedTime:`${a[2].slice(0,2)}-${a[1]}-${a[0]}\n${new Date(t.strCreatedTime).toLocaleTimeString()}`})});let f=await e({strUserPK:r.strUserId,strTenantId:r.strTenantId});return{...n,intTotalCount:c.objCount.length?c.objCount[0].intTotalCount:0,arrList:d,...f}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1);e.default=function({getOrderDetailsDB:t}){return async function({source:e,body:r}){let n=r.strOrderId,s={$and:[]};s.$and.push({chrStatus:"N"});try{if(!n)throw new o.default("INVALID_ORDER_ID");let i=[];if(s.$and.push({strOrderId:n}),i.push({$lookup:{from:a.CLN_ORDER_TRACKING,localField:"strOrderId",foreignField:"strOrderId",as:"arrTracks"}}),i.push({$lookup:{from:a.CLN_USER,localField:"strOrderedUserId",foreignField:"_id",as:"arrOrderUser"}}),i.push({$match:s}),r.strSort){let t={$sort:{[r.strSort]:"ASC"==r.strSortActive?1:-1}};i.push(t)}else{let t={$sort:{strCreatedTime:1}};i.push(t)}await i.push({$limit:Number(r.intLimit)||50});let l=await t({strTenantId:e.strTenantId||a.STR_COMMON_DB_TENANT_ID,arrQuery:i});if(l.length){let t={strOrderUserName:"",strExecutiveName:"",strDistributerName:""};return l[0].arrOrderUser&&l[0].arrOrderUser.length&&(t=l[0].arrOrderUser[0]||{},t.strOrderUserName=l[0].arrOrderUser[0].strName||null,delete l[0].arrOrderUser),l[0].arrExecutive&&l[0].arrExecutive.length&&(t.strExecutiveName=l[0].arrExecutive[0].strName||null,delete l[0].arrExecutive),l[0].arrDistributer&&l[0].arrDistributer.length&&(t.strDistributerName=l[0].arrDistributer[0].strName||null,delete l[0].arrDistributer),t={...l[0],...t},t.strCreatedTime=await new Date(l[0].strCreatedTime).toDateString()+"  "+new Date(l[0].strCreatedTime).toLocaleTimeString(),t}throw new o.default("INVALID_ORDER_ID")}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(3),s=r(1);e.default=function({getOneDB:t,orderEntityTracking:e,getOrderTrackingDB:r,createOrderTrackingDB:n,getUserDetailsDb:i,updateOrderStatusDB:l}){return async function({source:i,body:u}){let c=await a.getMongoDbTransConnection(),d=c.objTransactionClient,f=c.objSession;try{let a=u.strOrderId,_=(u.strOrderStatus,c.objConnection),y={session:f};if(!a)throw new o.default("INVALID_ORDER_ID");let D=await t({strCollection:s.CLN_ORDER,strTenantId:i.strTenantId,objQuery:{chrStatus:"N",strOrderId:a,strTenantId:i.strTenantId}}),h=await r({objConnection:_,arrQuery:[{$match:{$and:[{strTenantId:i.strTenantId},{chrStatus:"N"},{strOrderId:a}]}}]});console.log("objOrder"),console.log(D);let g=await e({...u,strMobileNo:D.strMobileNo,strName:D.strCustomerName,arrOrderTracking:h,strTenantId:i.strTenantId,strCreatedTime:i.timReceived,strCreatedUser:i.strUserId});await n({objConnection:_,objTransOptions:y,objTracking:g.objTracking});let b=[{$match:{$and:[{strTenantId:i.strTenantId},{chrStatus:"N"},{strOrderId:a}]}}],C=await l({objConnection:_,objTransOptions:y,objSet:g.objOrderStatus,strTenantId:i.strTenantId,arrQuery:b,strOrderId:a});return await f.commitTransaction(),{strMessage:"Success",...C}}catch(t){throw await f.abortTransaction(),new o.default(t)}finally{await d.close(),await f.endSession()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=n(r(81));e.default=function({getListOrderUsecase:t}){return async function({source:e,body:r}){try{let n=await t({source:e,body:{...r,blnNoPagination:!0}}),o=[],s=["Order# ","Date ","Items ","Total Amount ","GST ","Delivery Option","Order Notes ","Address ","Mobile "];return o.push(s),n.arrList.forEach(t=>{let e=[];e.push(t.strOrderId||""),e.push(t.strCreatedTime||""),e.push(t.strItem||""),e.push(t.dblTotalOrderAmount||""),e.push(t.strGST||""),e.push(t.strModeDelivery||""),e.push(t.strOrderNote||""),e.push(t.strAddress||""),e.push(t.strMobileNo||""),o.push(e)}),a.default.build([{name:"ORDER_LIST",data:o}])}catch(t){throw new o.default(t)}}}},function(t,e){t.exports=require("node-xlsx")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(4),s=r(1);e.createOrderControllerFactory=function({createOrderUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{strTenantId:r.strTenantId}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.getListOrderControllerFactory=function({getListOrderUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.getOrderDetailsControllerFactory=function({getOrderDetailsUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.updateOrderControllerFactory=function({updateOrderUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{strTenantId:r.strTenantId}});if(n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.getExportOrderControllerFactory=function({getExportOrderUsecase:t}){return async function({body:e,...r}){try{return{headers:{"Content-Type":"application/octet-stream","Last-Modified":r.timReceived,"Content-Disposition":"attachment; filename=ORDER_LIST.xls"},type:"application/vnd.ms-excel",body:await t({body:e,source:r})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=n(r(84)),s=r(3),i=r(10);let l=o.default.Router();l.use("/files_upload",a.default()),l.post("/files_upload",s.makeFileController(i.fileUploadeToS3Controller)),t.exports=l},function(t,e){t.exports=require("express-fileupload")},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(3);e.fileUploadeToS3ControllerFactory=function(){return async function({body:t,files:e,...r}){try{let r;if(!e.images)throw new o.default("FILES_MISSING","errModuleWise");return r=e.images.length>=2?await a.multiFilesToS3({arrFiles:e.images,strQuality:!!t.strQuality&&Number(t.strQuality),strType:t.strType||"",strFileNames:t.strFileNames?t.strFileNames:""}):await a.multiFilesToS3({arrFiles:[e.images],strQuality:!!t.strQuality&&Number(t.strQuality),strType:t.strType||"",strFileNames:t.strFileNames?t.strFileNames:""}),{body:r}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.getModuleSttingsControllerFactory=function({getModuleSettingsUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.createModuleSttingsControllerFactory=function({createModuleSettingsUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.getAutoCompleteControllerFactory=function({getAutoCompleteUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(89),a=r(4),s=n(r(91)),i=n(r(92)),l=n(r(93));let u=s.default({getModuleSettingsDB:o.getModuleSettingsDB});e.getModuleSettingsUsecase=u;let c=i.default({getAutoCompleteDB:o.getAutoCompleteDB});e.getAutoCompleteUsecase=c;let d=l.default({updateOneDB:a.updateOneDB,inserOneDB:a.inserOneDB});e.createModuleSettingsUsecase=d},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(90);let o=n.getModuleSettingsDBFactory();e.getModuleSettingsDB=o;let a=n.getAutoCompleteDBFactory();e.getAutoCompleteDB=a},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0)),s=r(1);e.getModuleSettingsDBFactory=function(){return async function({objQuery:t}){let e=await o.getMongoDbConnection();try{return e.collection(s.CLN_MODULE_SETTINGS).findOne(t)}catch(t){throw new a.default(t)}}},e.getAutoCompleteDBFactory=function(){return async function({strCollection:t,objQuery:e}){let r=await o.getMongoDbConnection();try{return r.collection(t).find(e).toArray()}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.default=function({getModuleSettingsDB:t}){return async function({source:e,body:r}){try{if(!r.strName)throw new o.default("INVALID_MODULE_NAME");let n={chrStatus:"N",strName:r.strName,strTenantId:e.strTenantId},a=await t({strTenantId:e.strTenantId,objQuery:n});return a?{...a,strName:r.strName}:{strName:r.strName}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.default=function({getAutoCompleteDB:t}){return async function({source:e,body:r}){try{if(!r.strCollection)throw new o.default("INVALID_MODULE_NAME");let n={$and:[{strName:{$regex:""+r.strValue,$options:"i"}},{chrStatus:"N"},{strTenantId:e.strTenantId}]};return r.objCondition&&n.$and.push(r.objCondition),{arrList:await t({strCollection:r.strCollection,strTenantId:e.strTenantId,objQuery:n})}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1),a=n(r(0)),s=r(2);e.default=function({updateOneDB:t,inserOneDB:e}){return async function({source:r,body:n}){try{if(!n.objSettings&&n.objSettings.strName)throw new a.default("MODULE_NAME_MISSING");if("UPDATE"==n.strOperationType){if(!n._id)throw new a.default("DOC_ID_MISSING");delete n.objSettings._id;await t({strCollection:o.CLN_MODULE_SETTINGS,objDocument:{strTenantId:r.strTenantId,...n.objSettings},objQuery:{_id:new s.ObjectID(n._id)}})}else await e({strCollection:o.CLN_MODULE_SETTINGS,objDocument:{strTenantId:r.strTenantId,...n.objSettings}});return{strMessage:"Success"}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(3),s=r(95);let i=o.default.Router();i.post("/get_user",a.makeController(s.getListUserController)),i.post("/inactivate_user",a.makeController(s.inActivateUserController)),i.post("/delete_user",a.makeController(s.deleteUserController)),i.post("/change_password",a.makeController(s.changePasswordController)),t.exports=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(96),o=r(97);let a=n.registerUserControllerFactory({registerUserUsecase:o.registerUserUsecase,updateUserUsecase:o.updateUserUsecase});e.registerUserController=a;let s=n.logInUserControllerFactory({logInUserUseCase:o.logInUserUseCase});e.logInUserController=s;let i=n.getListUserControllerFactory({getListUserUsecase:o.getListUserUsecase});e.getListUserController=i;let l=n.inActivateUserControllerFactory({inActivateUserUsecase:o.inActivateUserUsecase});e.inActivateUserController=l;let u=n.deleteUserControllerFactory({deleteUserUsecase:o.deleteUserUsecase});e.deleteUserController=u;let c=n.forgotPasswordControllerFactory({forgotPasswordUsecase:o.forgotPasswordUsecase});e.forgotPasswordController=c;let d=n.changePasswordControllerFactory({changePasswordUsecase:o.changePasswordUsecase});e.changePasswordController=d},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.registerUserControllerFactory=function({registerUserUsecase:t,updateUserUsecase:e}){return async function({body:r,...n}){try{return{body:"UPDATE"==r.strOperationType?await e({source:n,body:r}):await t({source:n,body:r})}}catch(t){return new o.default(t).send()}}},e.getListUserControllerFactory=function({getListUserUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.logInUserControllerFactory=function({logInUserUseCase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.forgotPasswordControllerFactory=function({forgotPasswordUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.changePasswordControllerFactory=function({changePasswordUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.inActivateUserControllerFactory=function({inActivateUserUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}},e.deleteUserControllerFactory=function({deleteUserUsecase:t}){return async function({body:e,...r}){try{return{body:await t({source:r,body:e})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(7),a=r(98),s=r(4),i=n(r(100)),l=n(r(101)),u=n(r(102)),c=n(r(103)),d=n(r(104)),f=n(r(105)),_=n(r(106)),y=n(r(107)),D=n(r(108)),h=n(r(109));let g=D.default(),b=y.default(),C=i.default({registerUserDb:o.registerUserDb,inserOneDB:s.inserOneDB,userEntity:a.userEntity});e.registerUserUsecase=C;let T=l.default({getUserDetailsDb:o.getUserDetailsDb});e.logInUserUseCase=T;let p=f.default({deleteDB:s.deleteDB});e.deleteUserUsecase=p;let S=u.default({getListUserDB:o.getListUserDB});e.getListUserUsecase=S;let w=d.default({inActivateUserUserDB:o.inActivateUserUserDB});e.inActivateUserUsecase=w;let I=c.default({userUpdateEntity:a.userUpdateEntity,updateUserDb:o.updateUserDb});e.updateUserUsecase=I;let m=_.default({userEntity:a.userEntity,inserManyDB:s.inserManyDB,getUserDetailsDb:o.getUserDetailsDb,registerUserDb:o.registerUserDb,updateOneDB:s.updateOneDB,sendOTPUsecase:b,verifyOTPUsecase:g});e.forgotPasswordUsecase=m;let M=h.default({getUserDetailsDb:o.getUserDetailsDb});e.changePasswordUsecase=M},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(99);let o=n.userEntityFactory();e.userEntity=o;let a=n.userUpdateEntityFactory();e.userUpdateEntity=a},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1),a=n(r(0)),s=r(4),i=r(3),l=r(2);e.userEntityFactory=function(){return async function({strName:t,strMobileNo:e,strEmail:r,strPinCode:n,strState:u,strDistrict:c,strCity:d,strPassword:f,strShopeName:_,strPlan:y,strCreatedTime:D,strCreatedUser:h}){try{let g=new a.default;if(_||g.add("SHOPE_NAME_MISSING"),!t&&t.length<4&&g.add("NAME_LENGTH_LESS"),!e&&e.length<9&&g.add("MOBILE_NO_LESS"),!f&&f.length<5&&g.add("PASSWORD_ERROR"),g.isError)throw g;{if(await s.removeDB({strCollection:o.CLN_USER,objQuery:{$or:[{chrStatus:"T"},{strName:t},{strTenantId:_},{strMobileNo:e}]}}),await s.getOneDB({strCollection:o.CLN_USER,objQuery:{$or:[{chrStatus:"N"}],strName:t}})&&g.add("NAME  ALREADY EXISTS "),await s.getOneDB({strCollection:o.CLN_USER,objQuery:{$or:[{chrStatus:"N"}],strTenantId:_}})&&g.add("SHOP NAME  ALREADY EXISTS "),await s.getOneDB({strCollection:o.CLN_USER,objQuery:{$or:[{chrStatus:"N"}],strMobileNo:e}})&&g.add(" MOBILE NUMBER ALREADY EXISTS "),g.isError)throw g;let a=await i.hashString(f.trim()),b=o.objModuleSettings;b.objShop.strMobileNumber=e;let C=[],T=new Date(new Date(D.getFullYear(),D.getMonth(),D.getDate()+15,0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}));return o.arrDeleveryOptions.forEach(t=>{C.push({strTenantId:_,strName:t,strImgUrl_0:"",chrStatus:"N"})}),{arrDeleveryOption:C,objPlan:{strPlan:y||"DEMO",chrStatus:"N",strPlanStatus:"ACTIVE",strTenantId:_,strCreatedTime:D||null,strCreatedUser:new l.ObjectID(h)||null,strPlanExpiryDate:T},objNewModuleSettings:{...b,strPlanExpiryDate:T,strUserName:t,strTenantId:_,strPlan:y||"DEMO",strPlanStatus:"ACTIVE"},objUser:{strName:t,strMobileNo:e,strEmail:r||"",strHashPassword:a,strPinCode:n||"",strState:u||"",strDistrict:c||"",strCity:d||"",strActiveStatus:"A",strType:"CLIENTS",chrStatus:"T",strPlanStatus:"ACTIVE",strPlan:y||"DEMO",strTenantId:_,strPlanExpiryDate:T,strCreatedTime:D||null,strCreatedUser:new l.ObjectID(h)||null}}}}catch(t){throw new a.default(t)}}},e.userUpdateEntityFactory=function(){return async function({_id:t,strName:e,strType:r,strEmail:n,strImageUrl:s,arrAddress:i,strModifiedTime:u,strModifiedUser:c}){try{let d=new a.default;if(t||d.add("_ID_MISSING"),!e&&e.length<4&&r!=o.USER_RETAILER&&d.add("NAME_LENGTH_LESS"),d.isError)throw d;return{_id:new l.ObjectID(t),objUser:{strName:e,strEmail:n,strImageUrl:s||"",arrAddress:i||[],strModifiedTime:u||null,strModifiedUser:new l.ObjectID(c)||null}}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(6),a=n(r(0));e.default=function({inserOneDB:t,userEntity:e,registerUserDb:r}){return async function({source:n,body:s}){try{let a=await e({...s,strCreatedTime:n.timReceived,strCreatedUser:n.strUserId});console.log(["objNewModuleSettings"]),console.log(a.objNewModuleSettings);let i=await t({strCollection:o.CLN_MODULE_SETTINGS,objDocument:a.objNewModuleSettings});return console.log("objRes\n\n"),console.log(i),r({objUser:a.objUser})}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0)),s=r(1);e.default=function({getUserDetailsDb:t}){return async function({source:e,body:r}){if((r.strName||r.strMobileNo)&&!r.strPassword)throw new a.default("CREDENTIAL_MISSING");let n=await t({strName:r.strName||null,strMobileNo:r.strMobileNo||null,strActiveStatus:"A"}),i="";if(n.strType!=r.strType)throw new a.default("YOU HAVE NO PERMISSION IN DASHBOARD");if(!await o.compareHashAndText(r.strPassword,n.strHashPassword))throw new a.default("CREDENTIAL_INVALID");return i=await o.jwtSignIn({strUserId:n._id.toString(),strName:n.strName,strType:n.strType},{issuer:"CARTME",subject:"123",audience:s.STR_COMMON_DB_TENANT_ID}),await o.setRedisData(i,n.strTenantId),await delete n.strHashPassword,{strToken:i,strEncryptToken:i,...n}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(9),a=n(r(0)),s=r(1),i=r(2);e.default=function({getListUserDB:t}){return async function({source:e,body:r}){try{let n={$and:[]};if(n.$and.push({chrStatus:"N"}),r.strDocId&&n.$and.push({_id:new i.ObjectID(r.strDocId)}),!r.strType)throw new a.default("INVALID_USER_TYPE","errCommon");r.strType==o.USER_CLIENTS&&n.$and.push({strType:o.USER_CLIENTS}),r.strType==o.USER_USER&&(n.$and.push({strType:o.USER_USER}),n.$and.push({strTenantId:e.strTenantId}),n.$and.push({chrOrderUser:"T"}),r.strSearch&&n.$and.push({strCustomerName:{$regex:""+r.strSearch,$options:"i"}})),r.strType==o.USER_ADMIN&&(n.$and.push({strType:o.USER_CLIENTS}),n.$and.push({strTenantId:e.strTenantId}));let l=[];if(l.push({$match:n}),r.strSort){let t={$sort:{[r.strSort]:"ASC"==r.strSortActive?1:-1}};l.push(t)}else l.push({$sort:{strCreatedTime:-1}});let u=Number(r.intPageNo)*Number(r.intLimit);await l.push({$limit:u+Number(r.intLimit)||80}),await l.push({$skip:u||0});let c=await t({strTenantId:e.strTenantId||s.STR_COMMON_DB_TENANT_ID,arrQuery:l});return{...r,intTotalCount:c.objCount[0]?c.objCount[0].intTotalCount:0,arrList:c.arrList}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(2);e.default=function({userUpdateEntity:t,updateUserDb:e}){return async function({source:r,body:n}){try{let o=await t({...n,strTenantId:r.strTenantId||a.STR_COMMON_DB_TENANT_ID,strModifiedTime:r.timReceived,strModifiedUser:r.strUserId}),i={};switch(n.strType){case a.USER_ADMIN:i={strWhatsAppNumber:n.strWhatsAppNumber||null};break;case a.USER_CUSTOMER:default:i={}}return await e({objQuery:{_id:new s.ObjectID(o._id)},objSetUser:{$set:{...o.objUser,...i}},strTenantId:r.strTenantId||a.STR_COMMON_DB_TENANT_ID}),{strMessage:"Success"}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.default=function({inActivateUserUserDB:t}){return async function({source:e,body:r}){try{let e=r.strUserDocId;if(!e)throw new o.default("INVALID_ID");let n={strActiveStatus:r.strActiveStatus||"I"};return await t({objUpdateUser:n,strUserDocId:e}),{strMessage:"Success"}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1),a=n(r(0)),s=r(2);e.default=function({deleteDB:t}){return async function({source:e,body:r}){try{let n=[];return r.arrDeleteId.forEach(t=>{n.push(new s.ObjectID(t))}),await t({arrDeleteId:n,strCollection:o.CLN_USER,strModifiedTime:e.timReceived,strModifiedUser:e.strUserId}),{strMessage:"DELETE_SUCCESS"}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0)),s=r(1);e.default=function({inserManyDB:t,userEntity:e,getUserDetailsDb:r,updateOneDB:n,sendOTPUsecase:i,registerUserDb:l,verifyOTPUsecase:u}){return async function({source:c,body:d}){if("REGISTER"==d.strStep){if(!d.strMobileNo)throw new a.default("MOBILE_MISSING");let r=await e({...d,strTenantId:c.strTenantId,strCreatedTime:c.timReceived,strCreatedUser:c.strUserId});await t({strCollection:s.CLN_DELEVERY_OPTION,arrInsertDocuments:r.arrDeleveryOption}),delete r.objNewModuleSettings._id;await t({strCollection:s.CLN_MODULE_SETTINGS,arrInsertDocuments:[r.objNewModuleSettings]});return await t({strCollection:s.CLN_PLAN,arrInsertDocuments:[r.objPlan]}),await l({objUser:r.objUser}),await i({source:c,objSMSAPI:{strMobileNo:d.strMobileNo}})}if("FORGOT"==d.strStep){if(!d.strMobileNo)throw new a.default("MOBILE NUMBER MISSING");let t=await r({strName:d.strName||null,strMobileNo:d.strMobileNo||null});if(!t.strName)throw new a.default("INVALID_USER");return{...await i({source:c,objSMSAPI:{strMobileNo:t.strMobileNo}}),strName:d.strName,strMobileNo:t.strMobileNo}}if("VERIFY"==d.strStep){if(!d.strMobileNo)throw new a.default("USER_NAME_MISSING");if(!d.strSessionId)throw new a.default("OTP_SESSION_MISSING");d.strRegister&&await n({strCollection:s.CLN_USER,objQuery:{strMobileNo:d.strMobileNo,chrStatus:"T"},objDocument:{chrStatus:"N"}});let t=await u({source:c,objSMSAPI:{strSessionId:d.strSessionId,strOTP:d.strOTP}}),e={};if("OTP Matched"==await t){if(e=await r({strName:d.strName||null,strMobileNo:d.strMobileNo||null}),d.strRegister){let t=s.objModuleSettings;t.strTenantId=c.strTenantId,t.objShop.strMobileNumber=d.strMobileNo,await n({strCollection:s.CLN_MODULE_SETTINGS,objQuery:{strUserName:d.strName,chrStatus:"T"},objDocument:{chrStatus:"N"}})}else{if(!d.strPassword&&d.strPassword.length<5)throw new a.default("PASSWORD_ERROR");let t={$set:{strHashPassword:await o.hashString(d.strPassword.trim())}};e=await r({strName:d.strName||null,strMobileNo:d.strMobileNo||null,objSetCart:t,strTenantId:s.STR_COMMON_DB_TENANT_ID})}return{...e}}throw new a.default("INVALID OTP")}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=n(r(11)),s=r(1);e.default=function(){return async function({source:t,objSMSAPI:e}){try{return(await a.default.get(`http://2factor.in/API/V1/${s.SMS_API_KEY}/SMS/${e.strMobileNo}/AUTOGEN`)).data}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=n(r(11)),s=r(1);e.default=function(){return async function({source:t,objSMSAPI:e}){try{return(await a.default.get(`https://2factor.in/API/V1/${s.SMS_API_KEY}/SMS/VERIFY/${e.strSessionId}/${e.strOTP}`)).data.Details}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=n(r(0));e.default=function({getUserDetailsDb:t}){return async function({source:e,body:r}){if(!r.strPassword&&r.strPassword.length<5)throw new a.default("PASSWORD_ERROR");let n={$set:{strHashPassword:await o.hashString(r.strPassword.trim())}};return{...await t({strUserPK:e.strUserId||null,objSetCart:n,strTenantId:e.strTenantId})}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(3),s=r(111);let i=o.default.Router();i.post("/get_dash",a.makeController(s.getClientDashController)),i.post("/get_report",a.makeController(s.getReportController)),t.exports=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(112),o=r(116);let a=o.getClientDashControllerFactory({getClientDashUsecase:n.getClientDashUsecase});e.getClientDashController=a;let s=o.getReportControllerFactory({getReportUsecase:n.getReportUsecase,getMonthWiseReportUsecase:n.getMonthWiseReportUsecase});e.getReportController=s},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(113)),a=n(r(114)),s=n(r(115)),i=r(4),l=r(7);let u=s.default({getListDB:i.getListDB});e.getClientDashUsecase=u;let c=o.default({getUserDetailsDb:l.getUserDetailsDb,getListDB:i.getListDB,getOneDB:i.getOneDB});e.getReportUsecase=c;let d=a.default({getUserDetailsDb:l.getUserDetailsDb,getListDB:i.getListDB});e.getMonthWiseReportUsecase=d},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(6),a=n(r(0)),s=r(1);e.default=function({getUserDetailsDb:t,getListDB:e,getOneDB:r}){return async function({source:t,body:r}){try{let n={arrData:[],arrXaxisValues:[]},a=[["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],["Tue","Wed","Thu","Fri","Sat","Sun","Mon"],["Wed","Thu","Fri","Sat","Sun","Mon","Tue"],["Thu","Fri","Sat","Sun","Mon","Tue","Wed"],["Fri","Sat","Sun","Mon","Tue","Wed","Thu"],["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]],i=new Date,l=i.getDay();switch(r.strReportType){case"SALE":{let o={$and:[]},u=[];switch(o.$and.push({chrStatus:"N"}),o.$and.push({strTenantId:t.strTenantId}),r.strDateFilter){case"TODAY":{n.arrXaxisValues.push("Today"),o.$and.push({strCreatedTime:{$gte:new Date(new Date(i.getFullYear(),i.getMonth(),i.getDate(),0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(i.getFullYear(),i.getMonth(),i.getDate(),23,59,59).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}}),console.log("SA"),console.log(o.$and),u.push({$match:o}),u.push({$group:{_id:null,dblTotalAmount:{$sum:"$dblTotalAmount"}}});let r=await e({strTenantId:t.strTenantId,strCollection:s.CLN_ORDER,arrQuery:u});console.log("arrTotalSale"),console.log(r),n.arrData=r;break}case"WEAK":{let r={};console.log("intCurrentDay"),console.log(l),n.arrXaxisValues=a[l];for(let o=6;o>-1;--o){r={strCreatedTime:{$gte:new Date(new Date(i.getFullYear(),i.getMonth(),i.getDate()-o,0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(i.getFullYear(),i.getMonth(),i.getDate()-o,23,59,59).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}},console.log("objMatch"),console.log(r);let a=await e({strTenantId:t.strTenantId,strCollection:s.CLN_ORDER,arrQuery:[{$match:{$and:[{chrStatus:"N"},{strTenantId:t.strTenantId},{...r}]}},{$group:{_id:null,dblTotalAmount:{$sum:"$dblTotalAmount"}}}]});console.log("arrTotalSale"),console.log(a),n.arrData.push(a[0]&&a[0].dblTotalAmount?a[0].dblTotalAmount:0)}break}case"MONTH":o.$and.push({strCreatedTime:{$gte:new Date(new Date(i.getFullYear(),i.getMonth(),1,0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:i}})}break}case"USER_LOG":switch(r.strDateFilter){case"WEAK":{let r={};n.arrXaxisValues=a[l];for(let a=6;a>-1;--a){r={strCreatedTime:{$gte:new Date(new Date(i.getFullYear(),i.getMonth(),i.getDate()-a,0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(i.getFullYear(),i.getMonth(),i.getDate()-a,23,59,59).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}},console.log("objMatch"),console.log(r);let s=await e({strTenantId:t.strTenantId,strCollection:o.CLN_USER,arrQuery:[{$match:{$and:[{chrStatus:"N"},{strType:"USER"},{strTenantId:t.strTenantId},{...r}]}},{$count:"intUserCount"}]});console.log("arrUsers"),console.log(s),n.arrData.push(s.length?s[0].intUserCount:0)}break}}}return{...n}}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1),s=r(2);e.default=function({getUserDetailsDb:t,getListDB:e}){return async function({source:r,body:n}){try{if(!n.strReportType)throw new o.default("INVALID_REPORT");if(!n.strExecutiveId)throw new o.default("INVALID_EXECUTIVE_ID");let i=await t({strUserPK:n.strExecutiveId||r.strUserId,strTenantId:r.strTenantId}),l=[],u={$and:[]},c=[];u.$and.push({chrStatus:"N"}),u.$and.push({strExecutiveId:new s.ObjectID(n.strExecutiveId)}),c.push({$match:u});let d=await e({strTenantId:r.strTenantId,strCollection:a.CLN_SALE_TARGET,arrQuery:[{$match:u}]}),f={$and:[]};f.$and.push({strUpdatedUser:new s.ObjectID(n.strExecutiveId)});for(let t=0;t<d.length;t++){const n=d[t];let o=0,s=await n.strTargetMonth.split("-");o=Number((new Date).getMonth())!=Number(s[0])-1?30:Number(new Date(new Date(Number(s[1]),Number(s[0])-1,Number((new Date).getDate())).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})).getDate())-Number(new Date(new Date(Number(s[1]),Number(s[0])-1,1).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})).getDate()),await u.$and.push({strCreatedTime:{$gte:new Date(new Date(Number(s[1]),Number(s[0])-1,1).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(Number(s[1]),Number(s[0]),1).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}}),await c.push({$match:u});let i=await e({strTenantId:r.strTenantId,strCollection:a.CLN_ORDER,arrQuery:c}),_=0;await i.forEach(t=>{_+=Number(t.dblTotalOrderAmount)}),f.$and.push({strCreatedTime:{$gte:new Date(new Date(Number(s[1]),Number(s[0])-1,1).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(Number(s[1]),Number(s[0]),1).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}}),console.log(f);let y=await e({strTenantId:r.strTenantId,strCollection:a.CLN_ATTENDANCE,arrQuery:[{$match:f},{$count:"intAttendanceCount"}]});console.log("arrAttendanceMonthWise"),console.log(y),await l.push({intAttendanceCount:await y[0]?y[0].intAttendanceCount:0,intTotalDays:o,dblTotalOrderAmount:_,...n})}return{...i,arrList:l}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(1);e.default=function({getListDB:t}){return async function({source:e,body:r}){try{let r=(await t({strCollection:a.CLN_PRODUCT,arrQuery:[{$match:{$and:[{strTenantId:e.strTenantId},{chrStatus:"N"}]}},{$count:"intProductCount"}]}))[0]||{};r.intTotalProduct=-1!=e.intProductCount?e.intProductCount:"";let n=await t({strCollection:a.CLN_USER,arrQuery:[{$match:{$and:[{strTenantId:e.strTenantId},{chrStatus:"N"},{chrOrderUser:"T"},{strType:a.USER_USER}]}},{$count:"intCustomerCount"}]}),o=await t({strTenantId:e.strTenantId,strCollection:a.CLN_ORDER,arrQuery:[{$match:{$and:[{strTenantId:e.strTenantId},{chrStatus:"N"},{strOrderStatus:a.STR_SEND}]}},{$group:{_id:null,dblTotalAmount:{$sum:"$dblTotalAmount"}}}]}),s=e.timReceived,i=await t({strTenantId:e.strTenantId,strCollection:a.CLN_ORDER,arrQuery:[{$match:{$and:[{strTenantId:e.strTenantId},{chrStatus:"N"},{strOrderStatus:a.STR_SEND},{strCreatedTime:{$gte:new Date(new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}}]}},{$group:{_id:null,dblTotalAmount:{$sum:"$dblTotalAmount"}}}]}),l=await t({strTenantId:e.strTenantId,strCollection:a.CLN_ORDER,arrQuery:[{$match:{$and:[{strTenantId:e.strTenantId},{chrStatus:"N"},{strCreatedTime:{$gte:new Date(new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),$lte:new Date(new Date(s.getFullYear(),s.getMonth(),s.getDate(),23,59,59).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))}}]}},{$count:"intTodayOrderCount"}]});console.log("arrTodayOrdrCount"),console.log(l),console.log(new Date(new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})));let u=await t({strTenantId:e.strTenantId,strCollection:a.CLN_ORDER,arrQuery:[{$match:{$and:[{strTenantId:e.strTenantId},{chrStatus:"N"}]}},{$count:"intOrderCount"}]});return console.log("arrOrdrCount"),console.log(u),{...r,intTotalSale:o[0]?o[0].dblTotalAmount:0,intTodaySale:i[0]?i[0].dblTotalAmount:0,...l[0],...u[0],intCustomerCount:n[0]?n[0].intCustomerCount:0}}catch(t){throw new o.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0)),a=r(4),s=r(1),i=r(2);e.getReportControllerFactory=function({getReportUsecase:t,getMonthWiseReportUsecase:e}){return async function({body:r,...n}){try{let i=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{strTenantId:n.strTenantId}});if(i&&"BLOCK"==i.strPlanStatus)throw new o.default("PLAN EXPIRED");return{body:"MONTHWISE"==r.strOrderType?await e({source:n,body:r}):await t({source:n,body:r})}}catch(t){return new o.default(t).send()}}},e.getClientDashControllerFactory=function({getClientDashUsecase:t}){return async function({body:e,...r}){try{let n=await a.getOneDB({strCollection:s.CLN_USER,objQuery:{_id:new i.ObjectId(r.strUserId)}});if(console.log(n),n&&"BLOCK"==n.strPlanStatus)throw new o.default("PLAN EXPIRED");let l=n.strPlan&&s.objPlan[n.strPlan]?n.strPlan:"DEMO",u=s.objPlan[l];return{body:await t({source:{...u,...r},body:e})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(3),s=r(10);let i=o.default.Router();i.post("/create_settings",a.makeController(s.createModuleSttingsController)),t.exports=i},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(5)),a=r(3),s=r(119);let i=o.default.Router();i.post("/create_payment_order",a.makeController(s.createPaymentsController)),t.exports=i},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=r(120);let o=r(123).createPaymentsControllerFactory({createPaymentUsecase:n.createPaymentUsecase,upgradePlanUsecase:n.upgradePlanUsecase});e.createPaymentsController=o},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(121)),a=n(r(122)),s=r(7);let i=o.default({getUserDetailsDb:s.getUserDetailsDb});e.createPaymentUsecase=i;let l=a.default({getUserDetailsDb:s.getUserDetailsDb});e.upgradePlanUsecase=l},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(12)),a=n(r(0)),s=r(13),i=r(4),l=r(1),u=r(2);e.default=function({getUserDetailsDb:t}){return async function({source:e,body:r}){try{if(console.log(l.objPlan[r.strPlan]),r.strPlan){if(l.objPlan[r.strPlan]){console.log("1");let n=await l.objPlan[r.strPlan].amount;console.log("1"),console.log(n);let a=new o.default({key_id:l.RAZORPAY_KEY_ID,key_secret:l.RAZORPAY_SECERT_ID});console.log("1");let c=s.v4();console.log("1");let d=await a.orders.create({amount:n,currency:"INR",receipt:c,notes:[r.strPlan,e.timReceived,,e.strUserId,,e.strTenantId]});console.log("123"),await i.inserOneDB({strCollection:l.CLN_PAYMENTS,objDocument:{amount:n,currency:"INR",receipt:c,strPlan:r.strPlan,...d,strCreatedTime:e.timReceived,strCreatedUserId:new u.ObjectId(e.strUserId)||"",strStatus:"CREATED"}});let f=await t({strUserPK:e.strUserId,strTenantId:e.strTenantId});return{...d,...f,key:l.RAZORPAY_KEY_ID}}throw new a.default("PLAN NAME INVALID")}throw new a.default("PLAN NAME MISSING")}catch(t){throw new a.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1),a=n(r(12)),s=n(r(0)),i=r(4),l=r(1);e.default=function({getUserDetailsDb:t}){return async function({source:e,body:r}){try{if(!r.id)throw new s.default("PAYMENT ID MISSING");let n=e.timReceived,u=new Date(new Date(n.getFullYear(),n.getMonth(),n.getDate()+30,0,0,0).toLocaleString("en-US",{timeZone:"Asia/Kolkata"})),c=new a.default({key_id:l.RAZORPAY_KEY_ID,key_secret:l.RAZORPAY_SECERT_ID}),d=await c.orders.fetch(r.id);if(!d&&!d.notes[0])throw new s.default("INVALID ORDER ID");console.log(d.notes[0]);let f=d.notes[0];if(console.log("objVerify"),console.log(d),console.log("status"),console.log(d.status),"paid"==d.status){let a={strPlan:f,strPlanExpiryDate:u,strPlanStatus:"ACTIVE"};await i.updateOneDB({strCollection:o.CLN_PLAN,objDocument:{strPlanStatus:"ACTIVE",strModifiedTie:n},objQuery:{chrStatus:"N",strTenantId:e.strTenantId}}),await i.inserOneDB({strCollection:o.CLN_PLAN,objDocument:{...a,strCreatedTime:n}});let s=await t({strUserPK:e.strUserId,strTenantId:e.strTenantId,objSetCart:{$set:{...a,strModifiedTime:n}}});return await i.updateOneDB({strCollection:o.CLN_MODULE_SETTINGS,objQuery:{chrStatus:"N",strTenantId:e.strTenantId},objDocument:{...a,strModifiedTime:n}}),await i.updateOneDB({strCollection:l.CLN_PAYMENTS,objDocument:{strStatus:"VERIFIED"},objQuery:{id:r.id}}),{strMessage:"PLAN UPGRADED",...s}}throw new s.default("PAYMENT FAILED")}catch(t){throw new s.default(t)}}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=n(r(0));e.createPaymentsControllerFactory=function({createPaymentUsecase:t,upgradePlanUsecase:e}){return async function({body:r,...n}){try{return{body:"VERIFY"==r.strStep?await e({source:n,body:r}):await t({source:n,body:r})}}catch(t){return new o.default(t).send()}}}},function(t,e,r){"use strict";function n(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),n(r(125)),n(r(126)),n(r(127))},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=r(1),s=n(r(0));e.jwtTokenChecking=async function(t,e,r){let n={"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))};try{let i=await t.headers["x-access-token"]||t.headers.authorization;if(!i)return e.status(401).set(n).send(new s.default("AUTHORIZATION_TOKEN_HEADER_IS_MISSING").send().body);{let l=i,u=await o.getRedisData(l);if(t.strTenantId=u,t.strToken=l,!u)return e.status(401).set(n).send(new s.default("INVALID_TOKEN_PROVIDED").send().body);{let e={issuer:"CARTME",subject:"123",audience:a.STR_COMMON_DB_TENANT_ID},n=await o.jwtVerify(l,e);t.strUserId=n.strUserId,t.strType=n.strType,r()}}}catch(t){return e.status(401).set(n).send(new s.default(t).send().body)}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(3),a=r(1),s=n(r(0));e.jwtTokenDecode=async function(t,e,r){let n={"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))};try{let e=t.headers["x-access-token"]||t.headers.authorization,n=t.headers.strappinfo||null;if(console.log(t.path),e){let s=await o.getRedisData(e);if(t.strTenantId=s,t.strToken=e,s){let n={issuer:"CARTME",subject:"123",audience:a.STR_COMMON_DB_TENANT_ID},s=await o.jwtVerify(e,n);t.strUserId=s.strUserId,t.strType=s.strType,r()}else n?(t.strTenantId=n,r()):n||"/user/login_user"!=t.path||(console.log(t.path),console.log("req"),r())}else n&&(t.strTenantId=n,r())}catch(t){return e.status(401).set(n).send(new s.default(t).send().body)}}},function(t,e,r){"use strict";var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const o=r(1),a=r(13),s=r(4),i=n(r(0));e.sessionValidator=async function(t,e,r){let n={"Content-Type":"application/json","Last-Modified":new Date((new Date).toLocaleString("en-US",{timeZone:"Asia/Kolkata"}))};try{let e=await t.headers.strappinfo,i=await t.headers.strtoken;t.strTenantId=e;await t.hostname;if(i){let l=await s.getOneDB({strCollection:o.CLN_USER,objSet:{strLastUpdate:n["Last-Modified"],strTenantId:e},objQuery:{strToken:i,chrStatus:"N",strTenantId:e}});if(t.strToken=i,l&&l._id)console.log("EXISTS"),t.strUserId=l._id;else{console.log("NOT EXISTS");let r=`${e}-${a.v4()}`;console.log(r);let i=await s.inserOneDB({strCollection:o.CLN_USER,objDocument:{strToken:r,strType:o.USER_USER,strLastUpdate:n["Last-Modified"],strCreatedTime:n["Last-Modified"],strTenantId:e,strMobileNo:"",chrStatus:"N",objDetails:{}}});t.strUserId=i.insertedId,t.strToken=r}r()}else{console.log("TOKEN NOT EXISTS");let i=`${e}-${a.v4()}`;console.log(i);let l=await s.inserOneDB({strCollection:o.CLN_USER,objDocument:{strToken:i,strType:o.USER_USER,strLastUpdate:n["Last-Modified"],strCreateTime:n["Last-Modified"],strTenantId:e,strMobileNo:"",objDetails:{}}});t.strUserId=l.insertedId,t.strToken=i,r()}}catch(t){return e.status(401).set(n).send(new i.default(t).send().body)}}}]);